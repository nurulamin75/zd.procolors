"use strict";(()=>{var un=Object.defineProperty,pn=Object.defineProperties;var gn=Object.getOwnPropertyDescriptors;var Ht=Object.getOwnPropertySymbols;var bn=Object.prototype.hasOwnProperty,yn=Object.prototype.propertyIsEnumerable;var qe=Math.pow,jt=(e,t,o)=>t in e?un(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,Wt=(e,t)=>{for(var o in t||(t={}))bn.call(t,o)&&jt(e,o,t[o]);if(Ht)for(var o of Ht(t))yn.call(t,o)&&jt(e,o,t[o]);return e},qt=(e,t)=>pn(e,gn(t));var M=(e,t)=>()=>(e&&(t=e(e=0)),t);var hn=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var G=(e,t,o)=>new Promise((n,a)=>{var s=i=>{try{r(o.next(i))}catch(l){a(l)}},c=i=>{try{r(o.throw(i))}catch(l){a(l)}},r=i=>i.done?n(i.value):Promise.resolve(i.value).then(s,c);r((o=o.apply(e,t)).next())});var te,Xe=M(()=>{_();te=(e,t=0,o=1)=>pe(ge(t,e),o)});var fe,Xt=M(()=>{Xe();fe=e=>{e._clipped=!1,e._unclipped=e.slice(0);for(let t=0;t<=3;t++)t<3?((e[t]<0||e[t]>255)&&(e._clipped=!0),e[t]=te(e[t],0,255)):t===3&&(e[t]=te(e[t],0,1));return e}});function T(e){return Yt[Object.prototype.toString.call(e)]||"object"}var Yt,Ie=M(()=>{Yt={};for(let e of["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"])Yt[`[object ${e}]`]=e.toLowerCase()});var R,Zt=M(()=>{Ie();R=(e,t=null)=>e.length>=3?Array.prototype.slice.call(e):T(e[0])=="object"&&t?t.split("").filter(o=>e[0][o]!==void 0).map(o=>e[0][o]):e[0]});var oe,Kt=M(()=>{Ie();oe=e=>{if(e.length<2)return null;let t=e.length-1;return T(e[t])=="string"?e[t].toLowerCase():null}});var Ae,pe,ge,K,we,Jt,Qt,_=M(()=>{Xt();Xe();Ie();Zt();Kt();({PI:Ae,min:pe,max:ge}=Math),K=Ae*2,we=Ae/3,Jt=Ae/180,Qt=180/Ae});var V,j=M(()=>{V={format:{},autodetect:[]}});var Ye,C,B=M(()=>{_();j();Ye=class{constructor(...t){let o=this;if(T(t[0])==="object"&&t[0].constructor&&t[0].constructor===this.constructor)return t[0];let n=oe(t),a=!1;if(!n){a=!0,V.sorted||(V.autodetect=V.autodetect.sort((s,c)=>c.p-s.p),V.sorted=!0);for(let s of V.autodetect)if(n=s.test(...t),n)break}if(V.format[n]){let s=V.format[n].apply(null,a?t:t.slice(0,-1));o._rgb=fe(s)}else throw new Error("unknown format: "+t);o._rgb.length===3&&o._rgb.push(1)}toString(){return T(this.hex)=="function"?this.hex():`[${this._rgb.join(",")}]`}},C=Ye});var eo,to=M(()=>{eo="2.6.0"});var Me,P,H=M(()=>{B();to();Me=(...e)=>new Me.Color(...e);Me.Color=C;Me.version=eo;P=Me});var In,oo,ro=M(()=>{_();In=(...e)=>{e=R(e,"cmyk");let[t,o,n,a]=e,s=e.length>4?e[4]:1;return a===1?[0,0,0,s]:[t>=1?0:255*(1-t)*(1-a),o>=1?0:255*(1-o)*(1-a),n>=1?0:255*(1-n)*(1-a),s]},oo=In});var no,Sn,ao,io=M(()=>{_();({max:no}=Math),Sn=(...e)=>{let[t,o,n]=R(e,"rgb");t=t/255,o=o/255,n=n/255;let a=1-no(t,no(o,n)),s=a<1?1/(1-a):0,c=(1-t-a)*s,r=(1-o-a)*s,i=(1-n-a)*s;return[c,r,i,a]},ao=Sn});var so=M(()=>{H();B();j();_();ro();io();C.prototype.cmyk=function(){return ao(this._rgb)};P.cmyk=(...e)=>new C(...e,"cmyk");V.format.cmyk=oo;V.autodetect.push({p:2,test:(...e)=>{if(e=R(e,"cmyk"),T(e)==="array"&&e.length===4)return"cmyk"}})});var Ze,Cn,lo,co=M(()=>{_();Ze=e=>Math.round(e*100)/100,Cn=(...e)=>{let t=R(e,"hsla"),o=oe(e)||"lsa";return t[0]=Ze(t[0]||0),t[1]=Ze(t[1]*100)+"%",t[2]=Ze(t[2]*100)+"%",o==="hsla"||t.length>3&&t[3]<1?(t[3]=t.length>3?t[3]:1,o="hsla"):t.length=3,`${o}(${t.join(",")})`},lo=Cn});var vn,xe,Ke=M(()=>{_();vn=(...e)=>{e=R(e,"rgba");let[t,o,n]=e;t/=255,o/=255,n/=255;let a=pe(t,o,n),s=ge(t,o,n),c=(s+a)/2,r,i;return s===a?(r=0,i=Number.NaN):r=c<.5?(s-a)/(s+a):(s-a)/(2-s-a),t==s?i=(o-n)/(s-a):o==s?i=2+(n-t)/(s-a):n==s&&(i=4+(t-o)/(s-a)),i*=60,i<0&&(i+=360),e.length>3&&e[3]!==void 0?[i,r,c,e[3]]:[i,r,c]},xe=vn});var Je,kn,fo,mo=M(()=>{_();co();Ke();({round:Je}=Math),kn=(...e)=>{let t=R(e,"rgba"),o=oe(e)||"rgb";return o.substr(0,3)=="hsl"?lo(xe(t),o):(t[0]=Je(t[0]),t[1]=Je(t[1]),t[2]=Je(t[2]),(o==="rgba"||t.length>3&&t[3]<1)&&(t[3]=t.length>3?t[3]:1,o="rgba"),`${o}(${t.slice(0,o==="rgb"?3:4).join(",")})`)},fo=kn});var Qe,An,Se,et=M(()=>{_();({round:Qe}=Math),An=(...e)=>{e=R(e,"hsl");let[t,o,n]=e,a,s,c;if(o===0)a=s=c=n*255;else{let r=[0,0,0],i=[0,0,0],l=n<.5?n*(1+o):n+o-n*o,f=2*n-l,d=t/360;r[0]=d+1/3,r[1]=d,r[2]=d-1/3;for(let u=0;u<3;u++)r[u]<0&&(r[u]+=1),r[u]>1&&(r[u]-=1),6*r[u]<1?i[u]=f+(l-f)*6*r[u]:2*r[u]<1?i[u]=l:3*r[u]<2?i[u]=f+(l-f)*(2/3-r[u])*6:i[u]=f;[a,s,c]=[Qe(i[0]*255),Qe(i[1]*255),Qe(i[2]*255)]}return e.length>3?[a,s,c,e[3]]:[a,s,c,1]},Se=An});var po,go,bo,yo,ho,Io,uo,So,tt,Co=M(()=>{et();j();po=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,go=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,bo=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,yo=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,ho=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,Io=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,{round:uo}=Math,So=e=>{e=e.toLowerCase().trim();let t;if(V.format.named)try{return V.format.named(e)}catch(o){}if(t=e.match(po)){let o=t.slice(1,4);for(let n=0;n<3;n++)o[n]=+o[n];return o[3]=1,o}if(t=e.match(go)){let o=t.slice(1,5);for(let n=0;n<4;n++)o[n]=+o[n];return o}if(t=e.match(bo)){let o=t.slice(1,4);for(let n=0;n<3;n++)o[n]=uo(o[n]*2.55);return o[3]=1,o}if(t=e.match(yo)){let o=t.slice(1,5);for(let n=0;n<3;n++)o[n]=uo(o[n]*2.55);return o[3]=+o[3],o}if(t=e.match(ho)){let o=t.slice(1,4);o[1]*=.01,o[2]*=.01;let n=Se(o);return n[3]=1,n}if(t=e.match(Io)){let o=t.slice(1,4);o[1]*=.01,o[2]*=.01;let n=Se(o);return n[3]=+t[4],n}};So.test=e=>po.test(e)||go.test(e)||bo.test(e)||yo.test(e)||ho.test(e)||Io.test(e);tt=So});var vo=M(()=>{H();B();j();_();mo();Co();C.prototype.css=function(e){return fo(this._rgb,e)};P.css=(...e)=>new C(...e,"css");V.format.css=tt;V.autodetect.push({p:5,test:(e,...t)=>{if(!t.length&&T(e)==="string"&&tt.test(e))return"css"}})});var ko=M(()=>{B();H();j();_();V.format.gl=(...e)=>{let t=R(e,"rgba");return t[0]*=255,t[1]*=255,t[2]*=255,t};P.gl=(...e)=>new C(...e,"gl");C.prototype.gl=function(){let e=this._rgb;return[e[0]/255,e[1]/255,e[2]/255,e[3]]}});var wn,Mn,Ao,wo=M(()=>{_();({floor:wn}=Math),Mn=(...e)=>{e=R(e,"hcg");let[t,o,n]=e,a,s,c;n=n*255;let r=o*255;if(o===0)a=s=c=n;else{t===360&&(t=0),t>360&&(t-=360),t<0&&(t+=360),t/=60;let i=wn(t),l=t-i,f=n*(1-o),d=f+r*(1-l),u=f+r*l,m=f+r;switch(i){case 0:[a,s,c]=[m,u,f];break;case 1:[a,s,c]=[d,m,f];break;case 2:[a,s,c]=[f,m,u];break;case 3:[a,s,c]=[f,d,m];break;case 4:[a,s,c]=[u,f,m];break;case 5:[a,s,c]=[m,f,d];break}}return[a,s,c,e.length>3?e[3]:1]},Ao=Mn});var xn,Mo,xo=M(()=>{_();xn=(...e)=>{let[t,o,n]=R(e,"rgb"),a=pe(t,o,n),s=ge(t,o,n),c=s-a,r=c*100/255,i=a/(255-c)*100,l;return c===0?l=Number.NaN:(t===s&&(l=(o-n)/c),o===s&&(l=2+(n-t)/c),n===s&&(l=4+(t-o)/c),l*=60,l<0&&(l+=360)),[l,r,i]},Mo=xn});var ot=M(()=>{_();H();B();j();wo();xo();C.prototype.hcg=function(){return Mo(this._rgb)};P.hcg=(...e)=>new C(...e,"hcg");V.format.hcg=Ao;V.autodetect.push({p:1,test:(...e)=>{if(e=R(e,"hcg"),T(e)==="array"&&e.length===3)return"hcg"}})});var En,Ln,$n,Ee,rt=M(()=>{En=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,Ln=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,$n=e=>{if(e.match(En)){(e.length===4||e.length===7)&&(e=e.substr(1)),e.length===3&&(e=e.split(""),e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);let t=parseInt(e,16),o=t>>16,n=t>>8&255,a=t&255;return[o,n,a,1]}if(e.match(Ln)){(e.length===5||e.length===9)&&(e=e.substr(1)),e.length===4&&(e=e.split(""),e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]);let t=parseInt(e,16),o=t>>24&255,n=t>>16&255,a=t>>8&255,s=Math.round((t&255)/255*100)/100;return[o,n,a,s]}throw new Error(`unknown hex color: ${e}`)},Ee=$n});var Le,Rn,$e,nt=M(()=>{_();({round:Le}=Math),Rn=(...e)=>{let[t,o,n,a]=R(e,"rgba"),s=oe(e)||"auto";a===void 0&&(a=1),s==="auto"&&(s=a<1?"rgba":"rgb"),t=Le(t),o=Le(o),n=Le(n);let r="000000"+(t<<16|o<<8|n).toString(16);r=r.substr(r.length-6);let i="0"+Le(a*255).toString(16);switch(i=i.substr(i.length-2),s.toLowerCase()){case"rgba":return`#${r}${i}`;case"argb":return`#${i}${r}`;default:return`#${r}`}},$e=Rn});var Eo=M(()=>{H();B();_();j();rt();nt();C.prototype.hex=function(e){return $e(this._rgb,e)};P.hex=(...e)=>new C(...e,"hex");V.format.hex=Ee;V.autodetect.push({p:4,test:(e,...t)=>{if(!t.length&&T(e)==="string"&&[3,4,5,6,7,8,9].indexOf(e.length)>=0)return"hex"}})});var be,Nn,Lo,$o=M(()=>{_();({cos:be}=Math),Nn=(...e)=>{e=R(e,"hsi");let[t,o,n]=e,a,s,c;return isNaN(t)&&(t=0),isNaN(o)&&(o=0),t>360&&(t-=360),t<0&&(t+=360),t/=360,t<1/3?(c=(1-o)/3,a=(1+o*be(K*t)/be(we-K*t))/3,s=1-(c+a)):t<2/3?(t-=1/3,a=(1-o)/3,s=(1+o*be(K*t)/be(we-K*t))/3,c=1-(a+s)):(t-=2/3,s=(1-o)/3,c=(1+o*be(K*t)/be(we-K*t))/3,a=1-(s+c)),a=te(n*a*3),s=te(n*s*3),c=te(n*c*3),[a*255,s*255,c*255,e.length>3?e[3]:1]},Lo=Nn});var On,Tn,Vn,Pn,Ro,No=M(()=>{_();({min:On,sqrt:Tn,acos:Vn}=Math),Pn=(...e)=>{let[t,o,n]=R(e,"rgb");t/=255,o/=255,n/=255;let a,s=On(t,o,n),c=(t+o+n)/3,r=c>0?1-s/c:0;return r===0?a=NaN:(a=(t-o+(t-n))/2,a/=Tn((t-o)*(t-o)+(t-n)*(o-n)),a=Vn(a),n>o&&(a=K-a),a/=K),[a*360,r,c]},Ro=Pn});var at=M(()=>{_();H();B();j();$o();No();C.prototype.hsi=function(){return Ro(this._rgb)};P.hsi=(...e)=>new C(...e,"hsi");V.format.hsi=Lo;V.autodetect.push({p:2,test:(...e)=>{if(e=R(e,"hsi"),T(e)==="array"&&e.length===3)return"hsi"}})});var Re=M(()=>{_();H();B();j();et();Ke();C.prototype.hsl=function(){return xe(this._rgb)};P.hsl=(...e)=>new C(...e,"hsl");V.format.hsl=Se;V.autodetect.push({p:2,test:(...e)=>{if(e=R(e,"hsl"),T(e)==="array"&&e.length===3)return"hsl"}})});var _n,Dn,Oo,To=M(()=>{_();({floor:_n}=Math),Dn=(...e)=>{e=R(e,"hsv");let[t,o,n]=e,a,s,c;if(n*=255,o===0)a=s=c=n;else{t===360&&(t=0),t>360&&(t-=360),t<0&&(t+=360),t/=60;let r=_n(t),i=t-r,l=n*(1-o),f=n*(1-o*i),d=n*(1-o*(1-i));switch(r){case 0:[a,s,c]=[n,d,l];break;case 1:[a,s,c]=[f,n,l];break;case 2:[a,s,c]=[l,n,d];break;case 3:[a,s,c]=[l,f,n];break;case 4:[a,s,c]=[d,l,n];break;case 5:[a,s,c]=[n,l,f];break}}return[a,s,c,e.length>3?e[3]:1]},Oo=Dn});var Bn,Fn,zn,Vo,Po=M(()=>{_();({min:Bn,max:Fn}=Math),zn=(...e)=>{e=R(e,"rgb");let[t,o,n]=e,a=Bn(t,o,n),s=Fn(t,o,n),c=s-a,r,i,l;return l=s/255,s===0?(r=Number.NaN,i=0):(i=c/s,t===s&&(r=(o-n)/c),o===s&&(r=2+(n-t)/c),n===s&&(r=4+(t-o)/c),r*=60,r<0&&(r+=360)),[r,i,l]},Vo=zn});var it=M(()=>{_();H();B();j();To();Po();C.prototype.hsv=function(){return Vo(this._rgb)};P.hsv=(...e)=>new C(...e,"hsv");V.format.hsv=Oo;V.autodetect.push({p:2,test:(...e)=>{if(e=R(e,"hsv"),T(e)==="array"&&e.length===3)return"hsv"}})});var q,Ce=M(()=>{q={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452}});var Gn,Un,st,lt,Ne,ct=M(()=>{Ce();_();({pow:Gn}=Math),Un=(...e)=>{e=R(e,"lab");let[t,o,n]=e,a,s,c,r,i,l;return s=(t+16)/116,a=isNaN(o)?s:s+o/500,c=isNaN(n)?s:s-n/200,s=q.Yn*lt(s),a=q.Xn*lt(a),c=q.Zn*lt(c),r=st(3.2404542*a-1.5371385*s-.4985314*c),i=st(-.969266*a+1.8760108*s+.041556*c),l=st(.0556434*a-.2040259*s+1.0572252*c),[r,i,l,e.length>3?e[3]:1]},st=e=>255*(e<=.00304?12.92*e:1.055*Gn(e,1/2.4)-.055),lt=e=>e>q.t1?e*e*e:q.t2*(e-q.t0),Ne=Un});var _o,Hn,ft,dt,jn,Oe,mt=M(()=>{Ce();_();({pow:_o}=Math),Hn=(...e)=>{let[t,o,n]=R(e,"rgb"),[a,s,c]=jn(t,o,n),r=116*s-16;return[r<0?0:r,500*(a-s),200*(s-c)]},ft=e=>(e/=255)<=.04045?e/12.92:_o((e+.055)/1.055,2.4),dt=e=>e>q.t3?_o(e,1/3):e/q.t2+q.t0,jn=(e,t,o)=>{e=ft(e),t=ft(t),o=ft(o);let n=dt((.4124564*e+.3575761*t+.1804375*o)/q.Xn),a=dt((.2126729*e+.7151522*t+.072175*o)/q.Yn),s=dt((.0193339*e+.119192*t+.9503041*o)/q.Zn);return[n,a,s]},Oe=Hn});var ye=M(()=>{_();H();B();j();ct();mt();C.prototype.lab=function(){return Oe(this._rgb)};P.lab=(...e)=>new C(...e,"lab");V.format.lab=Ne;V.autodetect.push({p:2,test:(...e)=>{if(e=R(e,"lab"),T(e)==="array"&&e.length===3)return"lab"}})});var Wn,qn,Xn,Te,ut=M(()=>{_();({sin:Wn,cos:qn}=Math),Xn=(...e)=>{let[t,o,n]=R(e,"lch");return isNaN(n)&&(n=0),n=n*Jt,[t,qn(n)*o,Wn(n)*o]},Te=Xn});var Yn,Ve,pt=M(()=>{_();ut();ct();Yn=(...e)=>{e=R(e,"lch");let[t,o,n]=e,[a,s,c]=Te(t,o,n),[r,i,l]=Ne(a,s,c);return[r,i,l,e.length>3?e[3]:1]},Ve=Yn});var Zn,Do,Bo=M(()=>{_();pt();Zn=(...e)=>{let t=R(e,"hcl").reverse();return Ve(...t)},Do=Zn});var Kn,Jn,Qn,ea,Pe,gt=M(()=>{_();({sqrt:Kn,atan2:Jn,round:Qn}=Math),ea=(...e)=>{let[t,o,n]=R(e,"lab"),a=Kn(o*o+n*n),s=(Jn(n,o)*Qt+360)%360;return Qn(a*1e4)===0&&(s=Number.NaN),[t,a,s]},Pe=ea});var ta,bt,Fo=M(()=>{_();mt();gt();ta=(...e)=>{let[t,o,n]=R(e,"rgb"),[a,s,c]=Oe(t,o,n);return Pe(a,s,c)},bt=ta});var ve=M(()=>{_();H();B();j();pt();Bo();Fo();C.prototype.lch=function(){return bt(this._rgb)};C.prototype.hcl=function(){return bt(this._rgb).reverse()};P.lch=(...e)=>new C(...e,"lch");P.hcl=(...e)=>new C(...e,"hcl");V.format.lch=Ve;V.format.hcl=Do;["lch","hcl"].forEach(e=>V.autodetect.push({p:2,test:(...t)=>{if(t=R(t,e),T(t)==="array"&&t.length===3)return e}}))});var oa,ae,yt=M(()=>{oa={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},ae=oa});var zo=M(()=>{B();j();_();yt();rt();nt();C.prototype.name=function(){let e=$e(this._rgb,"rgb");for(let t of Object.keys(ae))if(ae[t]===e)return t.toLowerCase();return e};V.format.named=e=>{if(e=e.toLowerCase(),ae[e])return Ee(ae[e]);throw new Error("unknown color name: "+e)};V.autodetect.push({p:5,test:(e,...t)=>{if(!t.length&&T(e)==="string"&&ae[e.toLowerCase()])return"named"}})});var ra,Go,Uo=M(()=>{_();ra=e=>{if(T(e)=="number"&&e>=0&&e<=16777215){let t=e>>16,o=e>>8&255,n=e&255;return[t,o,n,1]}throw new Error("unknown num color: "+e)},Go=ra});var na,Ho,jo=M(()=>{_();na=(...e)=>{let[t,o,n]=R(e,"rgb");return(t<<16)+(o<<8)+n},Ho=na});var ht=M(()=>{H();B();j();_();Uo();jo();C.prototype.num=function(){return Ho(this._rgb)};P.num=(...e)=>new C(...e,"num");V.format.num=Go;V.autodetect.push({p:5,test:(...e)=>{if(e.length===1&&T(e[0])==="number"&&e[0]>=0&&e[0]<=16777215)return"num"}})});var Wo,It=M(()=>{H();B();j();_();({round:Wo}=Math);C.prototype.rgb=function(e=!0){return e===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(Wo)};C.prototype.rgba=function(e=!0){return this._rgb.slice(0,4).map((t,o)=>o<3?e===!1?t:Wo(t):t)};P.rgb=(...e)=>new C(...e,"rgb");V.format.rgb=(...e)=>{let t=R(e,"rgba");return t[3]===void 0&&(t[3]=1),t};V.autodetect.push({p:3,test:(...e)=>{if(e=R(e,"rgba"),T(e)==="array"&&(e.length===3||e.length===4&&T(e[3])=="number"&&e[3]>=0&&e[3]<=1))return"rgb"}})});var _e,aa,De,St=M(()=>{({log:_e}=Math),aa=e=>{let t=e/100,o,n,a;return t<66?(o=255,n=t<6?0:-155.25485562709179-.44596950469579133*(n=t-2)+104.49216199393888*_e(n),a=t<20?0:-254.76935184120902+.8274096064007395*(a=t-10)+115.67994401066147*_e(a)):(o=351.97690566805693+.114206453784165*(o=t-55)-40.25366309332127*_e(o),n=325.4494125711974+.07943456536662342*(n=t-50)-28.0852963507957*_e(n),a=255),[o,n,a,1]},De=aa});var ia,sa,qo,Xo=M(()=>{St();_();({round:ia}=Math),sa=(...e)=>{let t=R(e,"rgb"),o=t[0],n=t[2],a=1e3,s=4e4,c=.4,r;for(;s-a>c;){r=(s+a)*.5;let i=De(r);i[2]/i[0]>=n/o?s=r:a=r}return ia(r)},qo=sa});var Yo=M(()=>{H();B();j();St();Xo();C.prototype.temp=C.prototype.kelvin=C.prototype.temperature=function(){return qo(this._rgb)};P.temp=P.kelvin=P.temperature=(...e)=>new C(...e,"temp");V.format.temp=V.format.kelvin=V.format.temperature=De});function Ct(e){let t=Math.abs(e);return t>.0031308?(la(e)||1)*(1.055*Be(t,1/2.4)-.055):e*12.92}var Be,la,ca,Fe,vt=M(()=>{_();({pow:Be,sign:la}=Math),ca=(...e)=>{e=R(e,"lab");let[t,o,n]=e,a=Be(t+.3963377774*o+.2158037573*n,3),s=Be(t-.1055613458*o-.0638541728*n,3),c=Be(t-.0894841775*o-1.291485548*n,3);return[255*Ct(4.0767416621*a-3.3077115913*s+.2309699292*c),255*Ct(-1.2684380046*a+2.6097574011*s-.3413193965*c),255*Ct(-.0041960863*a-.7034186147*s+1.707614701*c),e.length>3?e[3]:1]},Fe=ca});function At(e){let t=Math.abs(e);return t<.04045?e/12.92:(da(e)||1)*fa((t+.055)/1.055,2.4)}var kt,fa,da,ma,ze,wt=M(()=>{_();({cbrt:kt,pow:fa,sign:da}=Math),ma=(...e)=>{let[t,o,n]=R(e,"rgb"),[a,s,c]=[At(t/255),At(o/255),At(n/255)],r=kt(.4122214708*a+.5363325363*s+.0514459929*c),i=kt(.2119034982*a+.6806995451*s+.1073969566*c),l=kt(.0883024619*a+.2817188376*s+.6299787005*c);return[.2104542553*r+.793617785*i-.0040720468*l,1.9779984951*r-2.428592205*i+.4505937099*l,.0259040371*r+.7827717662*i-.808675766*l]},ze=ma});var Mt=M(()=>{_();H();B();j();vt();wt();C.prototype.oklab=function(){return ze(this._rgb)};P.oklab=(...e)=>new C(...e,"oklab");V.format.oklab=Fe;V.autodetect.push({p:3,test:(...e)=>{if(e=R(e,"oklab"),T(e)==="array"&&e.length===3)return"oklab"}})});var ua,Zo,Ko=M(()=>{_();ut();vt();ua=(...e)=>{e=R(e,"lch");let[t,o,n]=e,[a,s,c]=Te(t,o,n),[r,i,l]=Fe(a,s,c);return[r,i,l,e.length>3?e[3]:1]},Zo=ua});var pa,Jo,Qo=M(()=>{_();wt();gt();pa=(...e)=>{let[t,o,n]=R(e,"rgb"),[a,s,c]=ze(t,o,n);return Pe(a,s,c)},Jo=pa});var er=M(()=>{_();H();B();j();Ko();Qo();C.prototype.oklch=function(){return Jo(this._rgb)};P.oklch=(...e)=>new C(...e,"oklch");V.format.oklch=Zo;V.autodetect.push({p:3,test:(...e)=>{if(e=R(e,"oklch"),T(e)==="array"&&e.length===3)return"oklch"}})});var tr=M(()=>{B();_();C.prototype.alpha=function(e,t=!1){return e!==void 0&&T(e)==="number"?t?(this._rgb[3]=e,this):new C([this._rgb[0],this._rgb[1],this._rgb[2],e],"rgb"):this._rgb[3]}});var or=M(()=>{B();C.prototype.clipped=function(){return this._rgb._clipped||!1}});var rr=M(()=>{ye();B();Ce();C.prototype.darken=function(e=1){let t=this,o=t.lab();return o[0]-=q.Kn*e,new C(o,"lab").alpha(t.alpha(),!0)};C.prototype.brighten=function(e=1){return this.darken(-e)};C.prototype.darker=C.prototype.darken;C.prototype.brighter=C.prototype.brighten});var nr=M(()=>{B();C.prototype.get=function(e){let[t,o]=e.split("."),n=this[t]();if(o){let a=t.indexOf(o)-(t.substr(0,2)==="ok"?2:0);if(a>-1)return n[a];throw new Error(`unknown channel ${o} in mode ${t}`)}else return n}});var ga,ba,ya,ha,xt,Et=M(()=>{B();_();({pow:ga}=Math),ba=1e-7,ya=20;C.prototype.luminance=function(e,t="rgb"){if(e!==void 0&&T(e)==="number"){if(e===0)return new C([0,0,0,this._rgb[3]],"rgb");if(e===1)return new C([255,255,255,this._rgb[3]],"rgb");let o=this.luminance(),n=ya,a=(c,r)=>{let i=c.interpolate(r,.5,t),l=i.luminance();return Math.abs(e-l)<ba||!n--?i:l>e?a(c,i):a(i,r)},s=(o>e?a(new C([0,0,0]),this):a(this,new C([255,255,255]))).rgb();return new C([...s,this._rgb[3]])}return ha(...this._rgb.slice(0,3))};ha=(e,t,o)=>(e=xt(e),t=xt(t),o=xt(o),.2126*e+.7152*t+.0722*o),xt=e=>(e/=255,e<=.03928?e/12.92:ga((e+.055)/1.055,2.4))});var z,Z=M(()=>{z={}});var ie,Ge=M(()=>{B();_();Z();ie=(e,t,o=.5,...n)=>{let a=n[0]||"lrgb";if(!z[a]&&!n.length&&(a=Object.keys(z)[0]),!z[a])throw new Error(`interpolation mode ${a} is not defined`);return T(e)!=="object"&&(e=new C(e)),T(t)!=="object"&&(t=new C(t)),z[a](e,t,o).alpha(e.alpha()+o*(t.alpha()-e.alpha()))}});var ar=M(()=>{B();Ge();C.prototype.mix=C.prototype.interpolate=function(e,t=.5,...o){return ie(this,e,t,...o)}});var ir=M(()=>{B();C.prototype.premultiply=function(e=!1){let t=this._rgb,o=t[3];return e?(this._rgb=[t[0]*o,t[1]*o,t[2]*o,o],this):new C([t[0]*o,t[1]*o,t[2]*o,o],"rgb")}});var sr=M(()=>{ve();B();Ce();C.prototype.saturate=function(e=1){let t=this,o=t.lch();return o[1]+=q.Kn*e,o[1]<0&&(o[1]=0),new C(o,"lch").alpha(t.alpha(),!0)};C.prototype.desaturate=function(e=1){return this.saturate(-e)}});var lr=M(()=>{B();_();C.prototype.set=function(e,t,o=!1){let[n,a]=e.split("."),s=this[n]();if(a){let c=n.indexOf(a)-(n.substr(0,2)==="ok"?2:0);if(c>-1){if(T(t)=="string")switch(t.charAt(0)){case"+":s[c]+=+t;break;case"-":s[c]+=+t;break;case"*":s[c]*=+t.substr(1);break;case"/":s[c]/=+t.substr(1);break;default:s[c]=+t}else if(T(t)==="number")s[c]=t;else throw new Error("unsupported value for Color.set");let r=new C(s,n);return o?(this._rgb=r._rgb,this):r}throw new Error(`unknown channel ${a} in mode ${n}`)}else return s}});var cr=M(()=>{ye();B();Ge();C.prototype.tint=function(e=.5,...t){return ie(this,"white",e,...t)};C.prototype.shade=function(e=.5,...t){return ie(this,"black",e,...t)}});var Ia,fr=M(()=>{B();Z();Ia=(e,t,o)=>{let n=e._rgb,a=t._rgb;return new C(n[0]+o*(a[0]-n[0]),n[1]+o*(a[1]-n[1]),n[2]+o*(a[2]-n[2]),"rgb")};z.rgb=Ia});var Lt,he,Sa,dr=M(()=>{B();Z();({sqrt:Lt,pow:he}=Math),Sa=(e,t,o)=>{let[n,a,s]=e._rgb,[c,r,i]=t._rgb;return new C(Lt(he(n,2)*(1-o)+he(c,2)*o),Lt(he(a,2)*(1-o)+he(r,2)*o),Lt(he(s,2)*(1-o)+he(i,2)*o),"rgb")};z.lrgb=Sa});var Ca,mr=M(()=>{ye();Z();B();Ca=(e,t,o)=>{let n=e.lab(),a=t.lab();return new C(n[0]+o*(a[0]-n[0]),n[1]+o*(a[1]-n[1]),n[2]+o*(a[2]-n[2]),"lab")};z.lab=Ca});var J,de=M(()=>{B();J=(e,t,o,n)=>{let a,s;n==="hsl"?(a=e.hsl(),s=t.hsl()):n==="hsv"?(a=e.hsv(),s=t.hsv()):n==="hcg"?(a=e.hcg(),s=t.hcg()):n==="hsi"?(a=e.hsi(),s=t.hsi()):n==="lch"||n==="hcl"?(n="hcl",a=e.hcl(),s=t.hcl()):n==="oklch"&&(a=e.oklch().reverse(),s=t.oklch().reverse());let c,r,i,l,f,d;(n.substr(0,1)==="h"||n==="oklch")&&([c,i,f]=a,[r,l,d]=s);let u,m,b,k;return!isNaN(c)&&!isNaN(r)?(r>c&&r-c>180?k=r-(c+360):r<c&&c-r>180?k=r+360-c:k=r-c,m=c+o*k):isNaN(c)?isNaN(r)?m=Number.NaN:(m=r,(f==1||f==0)&&n!="hsv"&&(u=l)):(m=c,(d==1||d==0)&&n!="hsv"&&(u=i)),u===void 0&&(u=i+o*(l-i)),b=f+o*(d-f),n==="oklch"?new C([b,u,m],n):new C([m,u,b],n)}});var ur,pr=M(()=>{ve();de();Z();ur=(e,t,o)=>J(e,t,o,"lch");z.lch=ur;z.hcl=ur});var va,gr=M(()=>{ht();Z();B();va=(e,t,o)=>{let n=e.num(),a=t.num();return new C(n+o*(a-n),"num")};z.num=va});var ka,br=M(()=>{ot();de();Z();ka=(e,t,o)=>J(e,t,o,"hcg");z.hcg=ka});var Aa,yr=M(()=>{at();de();Z();Aa=(e,t,o)=>J(e,t,o,"hsi");z.hsi=Aa});var wa,hr=M(()=>{Re();de();Z();wa=(e,t,o)=>J(e,t,o,"hsl");z.hsl=wa});var Ma,Ir=M(()=>{it();de();Z();Ma=(e,t,o)=>J(e,t,o,"hsv");z.hsv=Ma});var xa,Sr=M(()=>{Mt();Z();B();xa=(e,t,o)=>{let n=e.oklab(),a=t.oklab();return new C(n[0]+o*(a[0]-n[0]),n[1]+o*(a[1]-n[1]),n[2]+o*(a[2]-n[2]),"oklab")};z.oklab=xa});var Ea,Cr=M(()=>{ve();de();Z();Ea=(e,t,o)=>J(e,t,o,"oklch");z.oklch=Ea});var $t,Rt,Nt,vr,kr,La,Ar,$a,wr=M(()=>{B();_();({pow:$t,sqrt:Rt,PI:Nt,cos:vr,sin:kr,atan2:La}=Math),Ar=(e,t="lrgb",o=null)=>{let n=e.length;o||(o=Array.from(new Array(n)).map(()=>1));let a=n/o.reduce(function(d,u){return d+u});if(o.forEach((d,u)=>{o[u]*=a}),e=e.map(d=>new C(d)),t==="lrgb")return $a(e,o);let s=e.shift(),c=s.get(t),r=[],i=0,l=0;for(let d=0;d<c.length;d++)if(c[d]=(c[d]||0)*o[0],r.push(isNaN(c[d])?0:o[0]),t.charAt(d)==="h"&&!isNaN(c[d])){let u=c[d]/180*Nt;i+=vr(u)*o[0],l+=kr(u)*o[0]}let f=s.alpha()*o[0];e.forEach((d,u)=>{let m=d.get(t);f+=d.alpha()*o[u+1];for(let b=0;b<c.length;b++)if(!isNaN(m[b]))if(r[b]+=o[u+1],t.charAt(b)==="h"){let k=m[b]/180*Nt;i+=vr(k)*o[u+1],l+=kr(k)*o[u+1]}else c[b]+=m[b]*o[u+1]});for(let d=0;d<c.length;d++)if(t.charAt(d)==="h"){let u=La(l/r[d],i/r[d])/Nt*180;for(;u<0;)u+=360;for(;u>=360;)u-=360;c[d]=u}else c[d]=c[d]/r[d];return f/=n,new C(c,t).alpha(f>.99999?1:f,!0)},$a=(e,t)=>{let o=e.length,n=[0,0,0,0];for(let a=0;a<e.length;a++){let s=e[a],c=t[a]/o,r=s._rgb;n[0]+=$t(r[0],2)*c,n[1]+=$t(r[1],2)*c,n[2]+=$t(r[2],2)*c,n[3]+=r[3]*c}return n[0]=Rt(n[0]),n[1]=Rt(n[1]),n[2]=Rt(n[2]),n[3]>.9999999&&(n[3]=1),new C(fe(n))}});function me(e){let t="rgb",o=P("#ccc"),n=0,a=[0,1],s=[],c=[0,0],r=!1,i=[],l=!1,f=0,d=1,u=!1,m={},b=!0,k=1,g=function(p){if(p=p||["#fff","#000"],p&&T(p)==="string"&&P.brewer&&P.brewer[p.toLowerCase()]&&(p=P.brewer[p.toLowerCase()]),T(p)==="array"){p.length===1&&(p=[p[0],p[0]]),p=p.slice(0);for(let A=0;A<p.length;A++)p[A]=P(p[A]);s.length=0;for(let A=0;A<p.length;A++)s.push(A/(p.length-1))}return x(),i=p},v=function(p){if(r!=null){let A=r.length-1,L=0;for(;L<A&&p>=r[L];)L++;return L-1}return 0},I=p=>p,h=p=>p,S=function(p,A){let L,y;if(A==null&&(A=!1),isNaN(p)||p===null)return o;A?y=p:r&&r.length>2?y=v(p)/(r.length-2):d!==f?y=(p-f)/(d-f):y=1,y=h(y),A||(y=I(y)),k!==1&&(y=Ra(y,k)),y=c[0]+y*(1-c[0]-c[1]),y=te(y,0,1);let E=Math.floor(y*1e4);if(b&&m[E])L=m[E];else{if(T(i)==="array")for(let $=0;$<s.length;$++){let O=s[$];if(y<=O){L=i[$];break}if(y>=O&&$===s.length-1){L=i[$];break}if(y>O&&y<s[$+1]){y=(y-O)/(s[$+1]-O),L=P.interpolate(i[$],i[$+1],y,t);break}}else T(i)==="function"&&(L=i(y));b&&(m[E]=L)}return L};var x=()=>m={};g(e);let w=function(p){let A=P(S(p));return l&&A[l]?A[l]():A};return w.classes=function(p){if(p!=null){if(T(p)==="array")r=p,a=[p[0],p[p.length-1]];else{let A=P.analyze(a);p===0?r=[A.min,A.max]:r=P.limits(A,"e",p)}return w}return r},w.domain=function(p){if(!arguments.length)return a;f=p[0],d=p[p.length-1],s=[];let A=i.length;if(p.length===A&&f!==d)for(let L of Array.from(p))s.push((L-f)/(d-f));else{for(let L=0;L<A;L++)s.push(L/(A-1));if(p.length>2){let L=p.map((E,$)=>$/(p.length-1)),y=p.map(E=>(E-f)/(d-f));y.every((E,$)=>L[$]===E)||(h=E=>{if(E<=0||E>=1)return E;let $=0;for(;E>=y[$+1];)$++;let O=(E-y[$])/(y[$+1]-y[$]);return L[$]+O*(L[$+1]-L[$])})}}return a=[f,d],w},w.mode=function(p){return arguments.length?(t=p,x(),w):t},w.range=function(p,A){return g(p,A),w},w.out=function(p){return l=p,w},w.spread=function(p){return arguments.length?(n=p,w):n},w.correctLightness=function(p){return p==null&&(p=!0),u=p,x(),u?I=function(A){let L=S(0,!0).lab()[0],y=S(1,!0).lab()[0],E=L>y,$=S(A,!0).lab()[0],O=L+(y-L)*A,N=$-O,D=0,F=1,X=20;for(;Math.abs(N)>.01&&X-- >0;)(function(){return E&&(N*=-1),N<0?(D=A,A+=(F-A)*.5):(F=A,A+=(D-A)*.5),$=S(A,!0).lab()[0],N=$-O})();return A}:I=A=>A,w},w.padding=function(p){return p!=null?(T(p)==="number"&&(p=[p,p]),c=p,w):c},w.colors=function(p,A){arguments.length<2&&(A="hex");let L=[];if(arguments.length===0)L=i.slice(0);else if(p===1)L=[w(.5)];else if(p>1){let y=a[0],E=a[1]-y;L=Na(0,p,!1).map($=>w(y+$/(p-1)*E))}else{e=[];let y=[];if(r&&r.length>2)for(let E=1,$=r.length,O=1<=$;O?E<$:E>$;O?E++:E--)y.push((r[E-1]+r[E])*.5);else y=a;L=y.map(E=>w(E))}return P[A]&&(L=L.map(y=>y[A]())),L},w.cache=function(p){return p!=null?(b=p,w):b},w.gamma=function(p){return p!=null?(k=p,w):k},w.nodata=function(p){return p!=null?(o=P(p),w):o},w}function Na(e,t,o){let n=[],a=e<t,s=o?a?t+1:t-1:t;for(let c=e;a?c<s:c>s;a?c++:c--)n.push(c);return n}var Ra,Ue=M(()=>{H();_();({pow:Ra}=Math)});var Oa,Ta,Mr,xr=M(()=>{B();ye();Ue();Oa=function(e){let t=[1,1];for(let o=1;o<e;o++){let n=[1];for(let a=1;a<=t.length;a++)n[a]=(t[a]||0)+t[a-1];t=n}return t},Ta=function(e){let t,o,n,a;if(e=e.map(s=>new C(s)),e.length===2)[o,n]=e.map(s=>s.lab()),t=function(s){let c=[0,1,2].map(r=>o[r]+s*(n[r]-o[r]));return new C(c,"lab")};else if(e.length===3)[o,n,a]=e.map(s=>s.lab()),t=function(s){let c=[0,1,2].map(r=>(1-s)*(1-s)*o[r]+2*(1-s)*s*n[r]+s*s*a[r]);return new C(c,"lab")};else if(e.length===4){let s;[o,n,a,s]=e.map(c=>c.lab()),t=function(c){let r=[0,1,2].map(i=>(1-c)*(1-c)*(1-c)*o[i]+3*(1-c)*(1-c)*c*n[i]+3*(1-c)*c*c*a[i]+c*c*c*s[i]);return new C(r,"lab")}}else if(e.length>=5){let s,c,r;s=e.map(i=>i.lab()),r=e.length-1,c=Oa(r),t=function(i){let l=1-i,f=[0,1,2].map(d=>s.reduce((u,m,b)=>u+c[b]*qe(l,r-b)*qe(i,b)*m[d],0));return new C(f,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return t},Mr=e=>{let t=Ta(e);return t.scale=()=>me(t),t}});var Q,se,le,Va,Pa,_a,Da,Ba,Fa,za,Ga,Er,Lr=M(()=>{It();H();Q=(e,t,o)=>{if(!Q[o])throw new Error("unknown blend mode "+o);return Q[o](e,t)},se=e=>(t,o)=>{let n=P(o).rgb(),a=P(t).rgb();return P.rgb(e(n,a))},le=e=>(t,o)=>{let n=[];return n[0]=e(t[0],o[0]),n[1]=e(t[1],o[1]),n[2]=e(t[2],o[2]),n},Va=e=>e,Pa=(e,t)=>e*t/255,_a=(e,t)=>e>t?t:e,Da=(e,t)=>e>t?e:t,Ba=(e,t)=>255*(1-(1-e/255)*(1-t/255)),Fa=(e,t)=>t<128?2*e*t/255:255*(1-2*(1-e/255)*(1-t/255)),za=(e,t)=>255*(1-(1-t/255)/(e/255)),Ga=(e,t)=>e===255?255:(e=255*(t/255)/(1-e/255),e>255?255:e);Q.normal=se(le(Va));Q.multiply=se(le(Pa));Q.screen=se(le(Ba));Q.overlay=se(le(Fa));Q.darken=se(le(_a));Q.lighten=se(le(Da));Q.dodge=se(le(Ga));Q.burn=se(le(za));Er=Q});function $r(e=300,t=-1.5,o=1,n=1,a=[0,1]){let s=0,c;T(a)==="array"?c=a[1]-a[0]:(c=0,a=[a,a]);let r=function(i){let l=K*((e+120)/360+t*i),f=Ua(a[0]+c*i,n),u=(s!==0?o[0]+i*s:o)*f*(1-f)/2,m=ja(l),b=Ha(l),k=f+u*(-.14861*m+1.78277*b),g=f+u*(-.29227*m-.90649*b),v=f+u*(1.97294*m);return P(fe([k*255,g*255,v*255,1]))};return r.start=function(i){return i==null?e:(e=i,r)},r.rotations=function(i){return i==null?t:(t=i,r)},r.gamma=function(i){return i==null?n:(n=i,r)},r.hue=function(i){return i==null?o:(o=i,T(o)==="array"?(s=o[1]-o[0],s===0&&(o=o[1])):s=0,r)},r.lightness=function(i){return i==null?a:(T(i)==="array"?(a=i,c=i[1]-i[0]):(a=[i,i],c=0),r)},r.scale=()=>P.scale(r),r.hue(o),r}var Ua,Ha,ja,Rr=M(()=>{_();H();({pow:Ua,sin:Ha,cos:ja}=Math)});var Wa,qa,Xa,Nr,Or=M(()=>{B();Wa="0123456789abcdef",{floor:qa,random:Xa}=Math,Nr=()=>{let e="#";for(let t=0;t<6;t++)e+=Wa.charAt(qa(Xa()*16));return new C(e,"hex")}});function Ot(e,t=null){let o={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return T(e)==="object"&&(e=Object.values(e)),e.forEach(n=>{t&&T(n)==="object"&&(n=n[t]),n!=null&&!isNaN(n)&&(o.values.push(n),o.sum+=n,n<o.min&&(o.min=n),n>o.max&&(o.max=n),o.count+=1)}),o.domain=[o.min,o.max],o.limits=(n,a)=>Tt(o,n,a),o}function Tt(e,t="equal",o=7){T(e)=="array"&&(e=Ot(e));let{min:n,max:a}=e,s=e.values.sort((r,i)=>r-i);if(o===1)return[n,a];let c=[];if(t.substr(0,1)==="c"&&(c.push(n),c.push(a)),t.substr(0,1)==="e"){c.push(n);for(let r=1;r<o;r++)c.push(n+r/o*(a-n));c.push(a)}else if(t.substr(0,1)==="l"){if(n<=0)throw new Error("Logarithmic scales are only possible for values > 0");let r=Math.LOG10E*Tr(n),i=Math.LOG10E*Tr(a);c.push(n);for(let l=1;l<o;l++)c.push(Ya(10,r+l/o*(i-r)));c.push(a)}else if(t.substr(0,1)==="q"){c.push(n);for(let r=1;r<o;r++){let i=(s.length-1)*r/o,l=Za(i);if(l===i)c.push(s[l]);else{let f=i-l;c.push(s[l]*(1-f)+s[l+1]*f)}}c.push(a)}else if(t.substr(0,1)==="k"){let r,i=s.length,l=new Array(i),f=new Array(o),d=!0,u=0,m=null;m=[],m.push(n);for(let g=1;g<o;g++)m.push(n+g/o*(a-n));for(m.push(a);d;){for(let v=0;v<o;v++)f[v]=0;for(let v=0;v<i;v++){let I=s[v],h=Number.MAX_VALUE,S;for(let x=0;x<o;x++){let w=Ka(m[x]-I);w<h&&(h=w,S=x),f[S]++,l[v]=S}}let g=new Array(o);for(let v=0;v<o;v++)g[v]=null;for(let v=0;v<i;v++)r=l[v],g[r]===null?g[r]=s[v]:g[r]+=s[v];for(let v=0;v<o;v++)g[v]*=1/f[v];d=!1;for(let v=0;v<o;v++)if(g[v]!==m[v]){d=!0;break}m=g,u++,u>200&&(d=!1)}let b={};for(let g=0;g<o;g++)b[g]=[];for(let g=0;g<i;g++)r=l[g],b[r].push(s[g]);let k=[];for(let g=0;g<o;g++)k.push(b[g][0]),k.push(b[g][b[g].length-1]);k=k.sort((g,v)=>g-v),c.push(k[0]);for(let g=1;g<k.length;g+=2){let v=k[g];!isNaN(v)&&c.indexOf(v)===-1&&c.push(v)}}return c}var Tr,Ya,Za,Ka,Vt=M(()=>{Ie();({log:Tr,pow:Ya,floor:Za,abs:Ka}=Math)});var Vr,Pr=M(()=>{B();Et();Vr=(e,t)=>{e=new C(e),t=new C(t);let o=e.luminance(),n=t.luminance();return o>n?(o+.05)/(n+.05):(n+.05)/(o+.05)}});function zr(e,t,o=1,n=1,a=1){var s=function(We){return 360*We/(2*Fr)},c=function(We){return 2*Fr*We/360};e=new C(e),t=new C(t);let[r,i,l]=Array.from(e.lab()),[f,d,u]=Array.from(t.lab()),m=(r+f)/2,b=re(W(i,2)+W(l,2)),k=re(W(d,2)+W(u,2)),g=(b+k)/2,v=.5*(1-re(W(g,7)/(W(g,7)+W(25,7)))),I=i*(1+v),h=d*(1+v),S=re(W(I,2)+W(l,2)),x=re(W(h,2)+W(u,2)),w=(S+x)/2,p=s(_r(l,I)),A=s(_r(u,h)),L=p>=0?p:p+360,y=A>=0?A:A+360,E=Dr(L-y)>180?(L+y+360)/2:(L+y)/2,$=1-.17*He(c(E-30))+.24*He(c(2*E))+.32*He(c(3*E+6))-.2*He(c(4*E-63)),O=y-L;O=Dr(O)<=180?O:y<=L?O+360:O-360,O=2*re(S*x)*Br(c(O)/2);let N=f-r,D=x-S,F=1+.015*W(m-50,2)/re(20+W(m-50,2)),X=1+.045*w,Y=1+.015*w*$,ue=30*ei(-W((E-275)/25,2)),dn=-(2*re(W(w,7)/(W(w,7)+W(25,7))))*Br(2*c(ue)),mn=re(W(N/(o*F),2)+W(D/(n*X),2)+W(O/(a*Y),2)+dn*(D/(n*X))*(O/(a*Y)));return Qa(0,Ja(100,mn))}var re,W,Ja,Qa,_r,Dr,He,Br,ei,Fr,Gr=M(()=>{B();({sqrt:re,pow:W,min:Ja,max:Qa,atan2:_r,abs:Dr,cos:He,sin:Br,exp:ei,PI:Fr}=Math)});function Ur(e,t,o="lab"){e=new C(e),t=new C(t);let n=e.get(o),a=t.get(o),s=0;for(let c in n){let r=(n[c]||0)-(a[c]||0);s+=r*r}return Math.sqrt(s)}var Hr=M(()=>{B()});var jr,Wr=M(()=>{B();jr=(...e)=>{try{return new C(...e),!0}catch(t){return!1}}});var qr,Xr=M(()=>{H();Re();Ue();qr={cool(){return me([P.hsl(180,1,.9),P.hsl(250,.7,.4)])},hot(){return me(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")}}});var je,Yr,Zr=M(()=>{je={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]};for(let e of Object.keys(je))je[e.toLowerCase()]=je[e];Yr=je});var ne,Kr=M(()=>{H();so();vo();ko();ot();Eo();at();Re();it();ye();ve();zo();ht();It();Yo();Mt();er();tr();or();rr();nr();Et();ar();ir();sr();lr();cr();fr();dr();mr();pr();gr();br();yr();hr();Ir();Sr();Cr();wr();xr();Lr();Rr();Ge();Or();Ue();Vt();Pr();Gr();Hr();Vt();Wr();j();Xr();yt();Zr();Object.assign(P,{average:Ar,bezier:Mr,blend:Er,cubehelix:$r,mix:ie,interpolate:ie,random:Nr,scale:me,analyze:Ot,contrast:Vr,deltaE:zr,distance:Ur,limits:Tt,valid:jr,scales:qr,input:V,colors:ae,brewer:Yr});ne=P});function Pt(e){return e.type==="SOLID"&&"boundVariables"in e&&e.boundVariables?Object.keys(e.boundVariables).length>0:!1}function _t(e,t){return t==="fill"&&"fillStyleId"in e?e.fillStyleId!==figma.mixed&&e.fillStyleId!=="":t==="stroke"&&"strokeStyleId"in e?e.strokeStyleId!==figma.mixed&&e.strokeStyleId!=="":t==="text"&&e.type==="TEXT"&&"fillStyleId"in e?e.fillStyleId!==figma.mixed&&e.fillStyleId!=="":!1}function Dt(e){return e.type==="SOLID"?{r:e.color.r,g:e.color.g,b:e.color.b}:null}function ti(e){let t=[];return"visible"in e&&e.visible===!1||("fills"in e&&Array.isArray(e.fills)&&!_t(e,"fill")&&e.fills.forEach((o,n)=>{if(o.type==="SOLID"&&!Pt(o)){let a=Dt(o);a&&t.push({nodeId:e.id,nodeName:e.name,property:"fill",rawColor:a,originalPaint:o})}}),"strokes"in e&&Array.isArray(e.strokes)&&!_t(e,"stroke")&&e.strokes.forEach((o,n)=>{if(o.type==="SOLID"&&!Pt(o)){let a=Dt(o);a&&t.push({nodeId:e.id,nodeName:e.name,property:"stroke",rawColor:a,originalPaint:o})}}),e.type==="TEXT"&&"fills"in e&&Array.isArray(e.fills)&&!_t(e,"text")&&e.fills.forEach(o=>{if(o.type==="SOLID"&&!Pt(o)){let n=Dt(o);n&&t.push({nodeId:e.id,nodeName:e.name,property:"text",rawColor:n,originalPaint:o})}})),t}function Bt(e){let t=[];function o(n){if(t.push(...ti(n)),"children"in n)for(let a of n.children)o(a)}for(let n of e)o(n);return t}function Jr(e){return Bt(e.children)}var Qr=M(()=>{"use strict"});function Ft(e){let t=e.r>.04045?Math.pow((e.r+.055)/1.055,2.4):e.r/12.92,o=e.g>.04045?Math.pow((e.g+.055)/1.055,2.4):e.g/12.92,n=e.b>.04045?Math.pow((e.b+.055)/1.055,2.4):e.b/12.92,a=(t*.4124564+o*.3575761+n*.1804375)/.95047,s=(t*.2126729+o*.7151522+n*.072175)/1,c=(t*.0193339+o*.119192+n*.9503041)/1.08883,r=a>.008856?Math.pow(a,1/3):7.787*a+16/116,i=s>.008856?Math.pow(s,1/3):7.787*s+16/116,l=c>.008856?Math.pow(c,1/3):7.787*c+16/116;return{l:116*i-16,a:500*(r-i),b:200*(i-l)}}function en(e,t){let o=e.l,n=e.a,a=e.b,s=t.l,c=t.a,r=t.b,i=Math.sqrt(n*n+a*a),l=Math.sqrt(c*c+r*r),f=(i+l)/2,d=.5*(1-Math.sqrt(Math.pow(f,7)/(Math.pow(f,7)+Math.pow(25,7)))),u=(1+d)*n,m=(1+d)*c,b=Math.sqrt(u*u+a*a),k=Math.sqrt(m*m+r*r),g=Math.atan2(a,u)*180/Math.PI,v=Math.atan2(r,m)*180/Math.PI,I=s-o,h=k-b,S=v-g;S>180?S-=360:S<-180&&(S+=360);let x=2*Math.sqrt(b*k)*Math.sin(S*Math.PI/360),w=(o+s)/2,p=(b+k)/2,A=(g+v)/2;Math.abs(g-v)>180&&(A+=180);let L=1-.17*Math.cos((A-30)*Math.PI/180)+.24*Math.cos(2*A*Math.PI/180)+.32*Math.cos((3*A+6)*Math.PI/180)-.2*Math.cos((4*A-63)*Math.PI/180),y=30*Math.exp(-Math.pow((A-275)/25,2)),E=2*Math.sqrt(Math.pow(p,7)/(Math.pow(p,7)+Math.pow(25,7))),$=-Math.sin(2*y*Math.PI/180)*E,O=1+.015*Math.pow(w-50,2)/Math.sqrt(20+Math.pow(w-50,2)),N=1+.045*p,D=1+.015*p*L,F=1,X=1,Y=1;return Math.sqrt(Math.pow(I/(F*O),2)+Math.pow(h/(X*N),2)+Math.pow(x/(Y*D),2)+$*(h/(X*N))*(x/(Y*D)))}function zt(e,t){if(t.length===0)return{match:null,deltaE:1/0};let o=Ft(e),n=t[0],a=en(o,Ft(t[0].valueRGB));for(let s=1;s<t.length;s++){let c=Ft(t[s].valueRGB),r=en(o,c);r<a&&(a=r,n=t[s])}return{match:n,deltaE:a}}var tn=M(()=>{"use strict"});function on(e,t,o,n,a=0){if(a>5)return null;try{let s=e.valuesByMode[t];if(typeof s=="object"&&"r"in s&&"g"in s&&"b"in s)return{r:s.r,g:s.g,b:s.b};if(typeof s=="object"&&"type"in s&&s.type==="VARIABLE_ALIAS"){let c=s.id,r=o.find(i=>i.id===c);if(r){let i=n.find(l=>l.id===r.variableCollectionId);if(i){let l=i.modes[0].modeId;return on(r,l,o,n,a+1)}}}}catch(s){console.warn(`Error resolving variable ${e.name}`,s)}return null}function oi(e){return e.type==="SOLID"?{r:e.color.r,g:e.color.g,b:e.color.b}:null}function ri(){return G(this,null,function*(){if(!figma.variables)return[];try{let e=yield figma.variables.getLocalVariableCollectionsAsync(),t=yield figma.variables.getLocalVariablesAsync(),o=[];for(let n of t)if(n.resolvedType==="COLOR"){let a=e.find(s=>s.id===n.variableCollectionId);if(a){let s=a.modes[0].modeId,c=on(n,s,t,e);c&&o.push({name:n.name,valueRGB:c,variableId:n.id,collectionId:a.id})}else console.warn(`Variable ${n.name} has no collection`)}return console.log(`Found ${o.length} color variables`),o}catch(e){return console.error("Error fetching variables:",e),[]}})}function ni(){return G(this,null,function*(){try{let e=yield figma.getLocalPaintStylesAsync(),t=[];for(let o of e)if(o.paints&&o.paints.length>0){let n=o.paints[0],a=oi(n);a&&t.push({name:o.name,valueRGB:a,styleId:o.id})}return console.log(`Found ${t.length} color styles`),t}catch(e){return console.error("Error fetching styles:",e),[]}})}function Gt(e,t,o=10){return G(this,null,function*(){let n=yield ri(),a=yield ni(),s=[];for(let c of e){let r,i,l=1/0,f=null;n.length>0&&(t==="variables"||!t)&&(f=zt(c.rawColor,n),f.match&&(r=f.match,l=f.deltaE));let d=null;a.length>0&&(t==="styles"||!t)&&(d=zt(c.rawColor,a),d.match&&(t==="styles"?(r=void 0,i=d.match,l=d.deltaE):t||(!r||d.deltaE<l)&&(r=void 0,i=d.match,l=d.deltaE)));let u=l<=o,b=!!(r||i)&&u;s.push({nodeId:c.nodeId,nodeName:c.nodeName,property:c.property,originalColor:c.rawColor,matchedVariable:b?r:void 0,matchedStyle:b?i:void 0,deltaE:l,isMatched:b,isCloseMatch:b})}return s})}var rn=M(()=>{"use strict";tn()});function ai(e,t,o){return G(this,null,function*(){var n,a,s,c,r,i;try{if(!figma.variables)return console.error("Variables API not available"),!1;if("locked"in e&&e.locked)return console.error(`Node ${e.id} is locked`),!1;if(!(yield figma.variables.getVariableByIdAsync(o.variableId)))return console.error(`Variable not found: ${o.variableId} (${o.name})`),!1;let f={r:o.valueRGB.r,g:o.valueRGB.g,b:o.valueRGB.b};if(console.log(`Binding variable ${o.name} (${o.variableId}) to ${e.name} ${t}`),t==="fill"&&"fills"in e&&Array.isArray(e.fills)){"fillStyleId"in e&&(e.fillStyleId="");try{let d={type:"SOLID",color:f};try{let u={type:"SOLID",color:f,boundVariables:{color:o.variableId}};e.fills=[u],yield new Promise(b=>setTimeout(b,20));let m=yield figma.getNodeByIdAsync(e.id);if(m&&"fills"in m){let b=(n=m.fills)==null?void 0:n[0];if(((a=b==null?void 0:b.boundVariables)==null?void 0:a.color)===o.variableId)return!0}}catch(u){console.warn(`Variable binding failed for ${o.name}, falling back to color value`)}return e.fills=[{type:"SOLID",color:f}],!0}catch(d){return console.error("Error setting fills:",d.message),!1}}else if(t==="stroke"&&"strokes"in e&&Array.isArray(e.strokes)){"strokeStyleId"in e&&(e.strokeStyleId="");try{let d={type:"SOLID",color:f,boundVariables:{color:o.variableId}};e.strokes=[d],yield new Promise(m=>setTimeout(m,20));let u=yield figma.getNodeByIdAsync(e.id);if(u&&"strokes"in u){let m=(s=u.strokes)==null?void 0:s[0];if(((c=m==null?void 0:m.boundVariables)==null?void 0:c.color)===o.variableId)return!0}return e.strokes=[{type:"SOLID",color:f}],!0}catch(d){return console.error("Error setting strokes:",d.message),!1}}else if(t==="text"&&e.type==="TEXT"&&"fills"in e&&Array.isArray(e.fills)){"fillStyleId"in e&&(e.fillStyleId="");try{let d={type:"SOLID",color:f,boundVariables:{color:o.variableId}};e.fills=[d],yield new Promise(m=>setTimeout(m,20));let u=yield figma.getNodeByIdAsync(e.id);if(u&&"fills"in u){let m=(r=u.fills)==null?void 0:r[0];if(((i=m==null?void 0:m.boundVariables)==null?void 0:i.color)===o.variableId)return!0}return e.fills=[{type:"SOLID",color:f}],!0}catch(d){return console.error("Error setting text fills:",d.message),!1}}return console.error(`Node type ${e.type} doesn't support ${t} property`),!1}catch(l){return console.error(`Error applying variable to ${e.id} (${e.name}):`,l),!1}})}function ii(e,t,o){return G(this,null,function*(){try{if("locked"in e&&e.locked)return console.error(`Node ${e.id} is locked`),!1;if(!figma.getStyleById(o.styleId))return console.error(`Style not found: ${o.styleId} (${o.name})`),!1;if(t==="fill"&&"fills"in e&&"fillStyleId"in e){if(Array.isArray(e.fills)&&e.fills.length>0){let a=e.fills[0];if(a.type==="SOLID"){let s=a;s.boundVariables&&Object.keys(s.boundVariables).length>0&&(e.fills=[{type:"SOLID",color:s.color,opacity:s.opacity!==void 0?s.opacity:1}])}}try{return e.fillStyleId=o.styleId,yield new Promise(a=>setTimeout(a,0)),e.fillStyleId===o.styleId}catch(a){return!1}}else if(t==="stroke"&&"strokes"in e&&"strokeStyleId"in e){if(Array.isArray(e.strokes)&&e.strokes.length>0){let a=e.strokes[0];if(a.type==="SOLID"){let s=a;s.boundVariables&&Object.keys(s.boundVariables).length>0&&(e.strokes=[{type:"SOLID",color:s.color,opacity:s.opacity!==void 0?s.opacity:1}])}}try{return e.strokeStyleId=o.styleId,yield new Promise(a=>setTimeout(a,0)),e.strokeStyleId===o.styleId}catch(a){return!1}}else if(t==="text"&&e.type==="TEXT"&&"fills"in e&&"fillStyleId"in e){if(Array.isArray(e.fills)&&e.fills.length>0){let a=e.fills[0];if(a.type==="SOLID"){let s=a;s.boundVariables&&Object.keys(s.boundVariables).length>0&&(e.fills=[{type:"SOLID",color:s.color,opacity:s.opacity!==void 0?s.opacity:1}])}}try{return e.fillStyleId=o.styleId,yield new Promise(a=>setTimeout(a,0)),e.fillStyleId===o.styleId}catch(a){return!1}}return!1}catch(n){return console.error(`Error applying style to ${e.id} (${e.name}):`,n),!1}})}function si(e,t){try{if(t==="fill"&&"fills"in e){let o=e.fills.length>0?e.fills[0]:void 0,n="fillStyleId"in e&&e.fillStyleId!==figma.mixed?e.fillStyleId:void 0;return{paint:o,styleId:n}}else if(t==="stroke"&&"strokes"in e){let o=e.strokes.length>0?e.strokes[0]:void 0,n="strokeStyleId"in e&&e.strokeStyleId!==figma.mixed?e.strokeStyleId:void 0;return{paint:o,styleId:n}}else if(t==="text"&&e.type==="TEXT"&&"fills"in e){let o=e.fills.length>0?e.fills[0]:void 0,n="fillStyleId"in e&&e.fillStyleId!==figma.mixed?e.fillStyleId:void 0;return{paint:o,styleId:n}}}catch(o){console.error(`Error storing original state for ${e.id}:`,o)}return null}function Ut(e){return G(this,null,function*(){let t=[],o=[];for(let n of e){if(!n.isMatched){t.push({nodeId:n.nodeId,nodeName:n.nodeName,property:n.property,success:!1,error:"No match found"});continue}try{let a=yield figma.getNodeByIdAsync(n.nodeId);if(!a){t.push({nodeId:n.nodeId,nodeName:n.nodeName,property:n.property,success:!1,error:"Node not found"});continue}if("locked"in a&&a.locked){t.push({nodeId:n.nodeId,nodeName:n.nodeName,property:n.property,success:!1,error:"Node is locked"});continue}let s=a.parent,c=!1;for(;s;){if("locked"in s&&s.locked){c=!0;break}s=s.parent}if(c){t.push({nodeId:n.nodeId,nodeName:n.nodeName,property:n.property,success:!1,error:"Node is in a locked group"});continue}let r=si(a,n.property);r&&o.push({nodeId:n.nodeId,property:n.property,originalPaint:r.paint?JSON.parse(JSON.stringify(r.paint)):void 0,originalStyleId:r.styleId});let i=!1,l="Failed to apply";n.matchedVariable?(i=yield ai(a,n.property,n.matchedVariable),i||(l="Failed to apply variable")):n.matchedStyle?(i=yield ii(a,n.property,n.matchedStyle),i||(l="Failed to apply style")):l="No variable or style to apply",t.push({nodeId:n.nodeId,nodeName:n.nodeName,property:n.property,success:i,error:i?void 0:l})}catch(a){t.push({nodeId:n.nodeId,nodeName:n.nodeName,property:n.property,success:!1,error:a.message||"Unknown error"})}}return{results:t,undoStates:o}})}function nn(e){return G(this,null,function*(){for(let t of e)try{let o=yield figma.getNodeByIdAsync(t.nodeId);if(!o)continue;t.property==="fill"&&"fills"in o?t.originalStyleId&&"fillStyleId"in o?o.fillStyleId=t.originalStyleId:t.originalPaint&&(o.fillStyleId="",o.fills=[t.originalPaint]):t.property==="stroke"&&"strokes"in o?t.originalStyleId&&"strokeStyleId"in o?o.strokeStyleId=t.originalStyleId:t.originalPaint&&(o.strokeStyleId="",o.strokes=[t.originalPaint]):t.property==="text"&&o.type==="TEXT"&&"fills"in o&&(t.originalStyleId&&"fillStyleId"in o?o.fillStyleId=t.originalStyleId:t.originalPaint&&(o.fillStyleId="",o.fills=[t.originalPaint]))}catch(o){console.error(`Error undoing replacement for ${t.nodeId}:`,o)}})}var an=M(()=>{"use strict"});function sn(e,t,o){return G(this,null,function*(){let n=Bt(e),a=yield Gt(n,t,o),{results:s,undoStates:c}=yield Ut(a),r=s.filter(l=>l.success).length,i=a.filter(l=>!l.isMatched&&l.deltaE===1/0).map(l=>({nodeId:l.nodeId,nodeName:l.nodeName,property:l.property,color:l.originalColor}));return{totalScanned:n.length,totalReplaced:r,matches:a,results:s,undoStates:c,unmatchedColors:i}})}function ln(e,t,o){return G(this,null,function*(){let n=Jr(e),a=yield Gt(n,t,o),{results:s,undoStates:c}=yield Ut(a),r=s.filter(l=>l.success).length,i=a.filter(l=>!l.isMatched&&l.deltaE===1/0).map(l=>({nodeId:l.nodeId,nodeName:l.nodeName,property:l.property,color:l.originalColor}));return{totalScanned:n.length,totalReplaced:r,matches:a,results:s,undoStates:c,unmatchedColors:i}})}function cn(e){return G(this,null,function*(){yield nn(e)})}var fn=M(()=>{"use strict";Qr();rn();an()});var ui=hn(ee=>{Kr();fn();figma.showUI(__html__,{width:900,height:650,themeColors:!0});function U(e){let t=ne.default||ne,[o,n,a]=t(e).rgb();return{r:o/255,g:n/255,b:a/255}}function ce(e,t,o){return(ne.default||ne)(e*255,t*255,o*255).hex()}var li={25:"lightest",50:"lighter",100:"light",200:"lighter-medium",300:"medium-light",400:"medium",500:"base",600:"medium-dark",700:"dark",800:"darker",900:"darkest",950:"darkest-plus",975:"darkest-max"};function ci(e,t,o,n){let a=e||"color";switch(o||"kebab-capital"){case"kebab-capital":return`${a.charAt(0).toUpperCase()+a.slice(1)}-${t}`;case"dot-lowercase":let c=li[t]||t.toString();return`${a.toLowerCase()}.${c}`;case"abbreviated":let r=a.charAt(0).toLowerCase(),i=t.toString().charAt(0);return`${r}${i} / ${t}`;case"custom":return(n||"{group}-{shade}").replace(/{group}/g,a).replace(/{shade}/g,t.toString());default:return t.toString()}}function fi(e,t){let o=e.toLowerCase();if(o==="primary"){if(t<=50)return"Primary Container";if(t<=100)return"On Primary Container";if(t<=200)return"Primary Fixed";if(t<=300)return"On Primary Fixed";if(t<=400)return"Primary Fixed Dim";if(t===500||t===600)return"Primary";if(t===700)return"On Primary";if(t>=800)return"Inverse Primary"}if(o==="secondary"){if(t<=50)return"Secondary Container";if(t<=100)return"On Secondary Container";if(t<=200)return"Secondary Fixed";if(t<=300)return"On Secondary Fixed";if(t<=400)return"Secondary Fixed Dim";if(t===500||t===600)return"Secondary";if(t===700)return"On Secondary";if(t>=800)return"Inverse Secondary"}if(o==="neutral"){if(t<=50)return"Surface";if(t<=100)return"On Surface";if(t<=200)return"Surface Container";if(t<=300)return"On Surface Container";if(t<=400)return"Surface Container High";if(t===500)return"Surface Container Highest";if(t===600)return"Inverse Surface";if(t===700)return"Inverse On Surface";if(t>=800)return"Outline";if(t>=900)return"Outline Variant"}if(o==="error"){if(t<=100)return"Error Container";if(t<=200)return"On Error Container";if(t===500)return"Error";if(t>=700)return"On Error"}if(o==="warning"){if(t<=100)return"Warning Container";if(t<=200)return"On Warning Container";if(t===500)return"Warning";if(t>=700)return"On Warning"}if(o==="success"){if(t<=100)return"Success Container";if(t<=200)return"On Success Container";if(t===500)return"Success";if(t>=700)return"On Success"}if(o==="info"){if(t<=100)return"Info Container";if(t<=200)return"On Info Container";if(t===500)return"Info";if(t>=700)return"On Info"}return t<=50?"Container":t<=100?"On Container":t<=200?"Fixed":t<=300?"On Fixed":t<=400?"Fixed Dim":t===500||t===600?e.charAt(0).toUpperCase()+e.slice(1):t===700?`On ${e.charAt(0).toUpperCase()+e.slice(1)}`:t>=800?`Inverse ${e.charAt(0).toUpperCase()+e.slice(1)}`:`Shade ${t}`}function di(e){return{50:950,100:900,200:800,300:700,400:600,500:500,600:400,700:300,800:200,900:100,950:50}[e]||e}function mi(e,t,o,n){let a=e[t];if(!a||!Array.isArray(a))return console.warn(`No tokens found for group ${t}`),null;if(n==="light"){let f=a.find(d=>d.shade===o);return(f==null?void 0:f.value)||null}let s=di(o),c=a.find(f=>f.shade===s);if(!c){console.warn(`Could not find inverted shade ${s} for base shade ${o} in ${t}. Available shades:`,a.map(d=>d.shade));let f=a.find(d=>d.shade===o);return(f==null?void 0:f.value)||null}let r=c.value;if(console.log(`Theme ${n}: Using shade ${s} color (${r}) for variable with base shade ${o}`),!ne.valid(r))return r;let i=ne(r),l=i;switch(n){case"dark":l=i.saturate(.1);break;case"dim":l=i.desaturate(.2);break;case"amoled":l=i.darken(.1).saturate(.15);break;default:break}return l.hex()}figma.ui.onmessage=e=>G(null,null,function*(){var n,a,s,c;if(e.type==="create-variables-from-colors"&&(console.log("=== MESSAGE RECEIVED IN PLUGIN CODE ==="),console.log("Message type:",e.type),console.log("Message data:",{colorsCount:(n=e.colors)==null?void 0:n.length,collectionId:e.collectionId,createNewCollection:e.createNewCollection})),e.type==="get-target-options"){if(e.targetType==="variables")if(figma.variables)try{let i=(yield figma.variables.getLocalVariableCollectionsAsync()).map(l=>({label:l.name,value:l.id}));figma.ui.postMessage({type:"target-options-response",targetType:"variables",options:i})}catch(r){figma.notify("Error fetching collections")}else figma.ui.postMessage({type:"target-options-response",targetType:"variables",options:[]});else if(e.targetType==="styles")try{let r=yield figma.getLocalPaintStylesAsync(),i=new Set;r.forEach(f=>{if(f.name.includes("/")){let u=f.name.split("/")[0];i.add(u)}});let l=Array.from(i).map(f=>({label:f,value:f}));l.unshift({label:"(Root)",value:""}),figma.ui.postMessage({type:"target-options-response",targetType:"styles",options:l})}catch(r){figma.notify("Error fetching styles")}}if(e.type==="create-color-styles"){let{palettes:r,action:i,targetId:l}=e,f=0;try{let d=yield figma.getLocalPaintStylesAsync(),u=new Map(d.map(b=>[b.name,b])),m="";i==="create"?m=`ProColors (${new Date().toLocaleString("en-GB",{month:"short",day:"numeric",hour:"numeric",minute:"numeric"})})/`:i==="update"&&(m=l?l.endsWith("/")?l:`${l}/`:"",l===""&&(m=""));for(let[b,k]of Object.entries(r))for(let g of k){let v=`${b}/${g.shade}`,I=m+v,h;h=u.get(I),h||(h=figma.createPaintStyle(),h.name=I,u.set(I,h));let{r:S,g:x,b:w}=U(g.value);h.paints=[{type:"SOLID",color:{r:S,g:x,b:w}}],h.description=`Generated by ProColors. Value: ${g.value}`,f++}figma.notify(`Success! ${i==="create"?"Created new":"Updated"} ${f} color styles.`)}catch(d){console.error("ProColors Error:",d),figma.notify(`Error creating styles: ${d.message}`)}}if(e.type==="create-color-variables"){if(!figma.variables){figma.notify("Error: Variables API is not available in this file.");return}let{palettes:r,action:i,targetId:l,variableType:f,collectionId:d,brandName:u,namingConvention:m,customNamingPattern:b}=e,k=0,g=0;try{let v=yield figma.variables.getLocalVariableCollectionsAsync(),I,h,S=u&&u.trim()?`${u.trim()} Token`:"ProColors Token";if(i==="create")if(f==="collection"){let y=new Date().toLocaleString("en-GB",{month:"short",day:"numeric",hour:"numeric",minute:"numeric"});I=figma.variables.createVariableCollection(`${S} (${y})`)}else if(f==="alias"||f==="component"){if(!d){figma.notify("Error: No collection selected. Please select a collection to add variables to.");return}if(I=v.find(y=>y.id===d),!I){figma.notify("Error: Selected collection not found.");return}}else{let y=new Date().toLocaleString("en-GB",{month:"short",day:"numeric",hour:"numeric",minute:"numeric"});I=figma.variables.createVariableCollection(`${S} (${y})`)}else if(i==="update"&&(l&&(I=v.find(y=>y.id===l)),I||(I=v.find(y=>y.name===S)),!I)){let y=new Date().toLocaleString("en-GB",{month:"short",day:"numeric",hour:"numeric",minute:"numeric"});I=figma.variables.createVariableCollection(`${S} (${y})`)}if(!I)throw new Error("Could not determine variable collection.");let x=I.modes[0].modeId,w=yield figma.variables.getLocalVariablesAsync(),p=w.filter(y=>y.variableCollectionId===I.id),A=new Map(p.map(y=>[y.name,y])),L=new Map;if(f==="alias"||f==="component"){let y=w.filter(E=>E.variableCollectionId===I.id);L=new Map(y.map(E=>[E.name,E]))}for(let[y,E]of Object.entries(r))for(let $ of E){let O;if(f==="component"){let N=fi(y,$.shade);O=`Component/${y}/${N}`}else if(f==="alias"){let N=ci(y,$.shade,m,b);O=`Alias/${y}/${N}`}else O=`Base Tokens/${y}/${$.shade}`;try{let N=A.get(O);if(f==="alias"){let D=`Base Tokens/${y}/${$.shade}`,F=L.get(D);if(F)N||(N=figma.variables.createVariable(O,I,"COLOR"),A.set(O,N)),N.setValueForMode(x,{type:"VARIABLE_ALIAS",id:F.id});else{console.warn(`Source variable ${D} not found, creating new variable instead.`);let{r:X,g:Y,b:ue}=U($.value),ke={r:X,g:Y,b:ue,a:1};N||(N=figma.variables.createVariable(O,I,"COLOR"),A.set(O,N)),N.setValueForMode(x,ke)}}else if(f==="component"){let D=`Base Tokens/${y}/${$.shade}`,F=L.get(D);if(F)N||(N=figma.variables.createVariable(O,I,"COLOR"),A.set(O,N)),N.setValueForMode(x,{type:"VARIABLE_ALIAS",id:F.id});else{console.warn(`Source variable ${D} not found in collection. Creating new variable instead.`);let{r:X,g:Y,b:ue}=U($.value),ke={r:X,g:Y,b:ue,a:1};N||(N=figma.variables.createVariable(O,I,"COLOR"),A.set(O,N)),N.setValueForMode(x,ke)}}else{let{r:D,g:F,b:X}=U($.value),Y={r:D,g:F,b:X,a:1};N||(N=figma.variables.createVariable(O,I,"COLOR"),A.set(O,N)),N.setValueForMode(x,Y)}k++}catch(N){console.error(`Failed to create variable ${O}:`,N),g++}}if(g>0)figma.notify(`Processed ${k} variables. Failed: ${g}. Check console.`);else{let y=f==="alias"?"alias":f==="component"?"component token":"";figma.notify(`Success! ${i==="create"?"Created new":"Updated"} ${k} ${y} variables in "${I.name}".`)}}catch(v){console.error("Magic Color Error:",v),figma.notify(`Error: ${v.message||"Unknown error"}`)}}if(e.type==="create-mesh-variables"){if(!figma.variables){figma.notify("Error: Variables API not available.");return}let{colors:r,name:i}=e;try{let f=(yield figma.variables.getLocalVariableCollectionsAsync()).find(k=>k.name==="Mesh Studio Colors");f||(f=figma.variables.createVariableCollection("Mesh Studio Colors"));let d=f.modes[0].modeId,m=(yield figma.variables.getLocalVariablesAsync()).filter(k=>k.variableCollectionId===f.id),b=new Map(m.map(k=>[k.name,k]));for(let k=0;k<r.length;k++){let g=`${i||"Mesh"}/Point ${k+1}`,v=b.get(g);v||(v=figma.variables.createVariable(g,f,"COLOR"));let{r:I,g:h,b:S}=U(r[k]);v.setValueForMode(d,{r:I,g:h,b:S,a:1})}figma.notify(`Success! Synced ${r.length} mesh colors to "Mesh Studio Colors" collection.`)}catch(l){figma.notify(`Error syncing variables: ${l.message}`)}}if(e.type==="get-collections-for-theme"){if(!figma.variables){figma.ui.postMessage({type:"collections-response",collections:[]});return}try{let i=(yield figma.variables.getLocalVariableCollectionsAsync()).map(l=>({id:l.id,name:l.name}));figma.ui.postMessage({type:"collections-response",collections:i})}catch(r){console.error("Error fetching collections:",r),figma.ui.postMessage({type:"collections-response",collections:[]})}}if(e.type==="create-theme-variable"){if(!figma.variables){figma.notify("Error: Variables API is not available in this file.");return}let{theme:r,palettes:i,collectionId:l}=e;if(console.log("Creating theme variables for theme:",r,"collectionId:",l),!i||Object.keys(i).length===0){figma.notify("Error: No palettes provided.");return}if(!l){figma.notify("Error: No collection selected.");return}let f=0,d=0;try{let m=(yield figma.variables.getLocalVariableCollectionsAsync()).find(I=>I.id===l);if(!m){figma.notify("Error: Collection not found.");return}console.log("Available modes before:",m.modes.map(I=>({name:I.name,id:I.modeId}))),console.log("Looking for theme:",r);let b=(a=m.modes.find(I=>{let h=I.name.toLowerCase().trim(),S=r.toLowerCase().trim(),x=h===S;return console.log(`Comparing mode "${I.name}" (${h}) with theme "${r}" (${S}): ${x}`),x}))==null?void 0:a.modeId;if(b){let I=m.modes.find(h=>h.modeId===b);console.log(`Using existing mode "${I==null?void 0:I.name}" (ID: ${b}) for theme "${r}"`)}else try{console.log(`Creating new mode: ${r}`),b=m.addMode(r).modeId,console.log(`Created mode "${r}" with ID: ${b}`);let S=(yield figma.variables.getLocalVariableCollectionsAsync()).find(x=>x.id===l);S&&console.log("Updated modes after creation:",S.modes.map(x=>({name:x.name,id:x.modeId})))}catch(I){console.error("Error creating mode:",I),figma.notify(`Error: Could not create new mode. ${I.message}`);return}console.log(`Final modeId for theme "${r}": ${b}`);let g=(yield figma.variables.getLocalVariablesAsync()).filter(I=>I.variableCollectionId===m.id&&I.resolvedType==="COLOR");console.log(`Found ${g.length} color variables in collection "${m.name}"`),console.log("Variable names:",g.map(I=>I.name));let v=(I,h)=>{let S=g.find(y=>y.name===`${I}/${h}`);if(S)return S;let x=`${I}/${h}`,w=`/${I}/${h}`,p=g.find(y=>y.name.endsWith(x)||y.name.includes(w));if(p)return p;let A=I.toLowerCase();return g.find(y=>{let E=y.name.toLowerCase();return E.endsWith(`${A}/${h}`)||E.includes(`/${A}/${h}`)})||null};for(let[I,h]of Object.entries(i)){if(!Array.isArray(h)){console.warn(`Skipping ${I}: not an array`,h);continue}for(let S of h){if(!S||!S.shade||!S.value){console.warn(`Skipping invalid token in ${I}:`,S);continue}try{let x=v(I,S.shade);if(!x){console.log(`No existing variable found for ${I}/${S.shade}, skipping (not creating new)`);continue}let w=mi(i,I,S.shade,r);if(!w){console.warn(`Could not get theme color for ${x.name} in theme ${r}`);continue}console.log(`Updating ${x.name}: shade ${S.shade} -> Theme ${r} color ${w}`);let{r:p,g:A,b:L}=U(w),y={r:p,g:A,b:L,a:1};x.setValueForMode(b,y),f++}catch(x){console.error(`Failed to update variable for ${I}/${S.shade}:`,x),d++}}}f===0?figma.notify(`No matching variables found in "${m.name}". Make sure variable names match your palette groups.`):d>0?figma.notify(`Updated ${f} variables for "${r}" theme. Failed: ${d}. Check console.`):figma.notify(`Success! Added "${r}" theme mode with ${f} updated variables to "${m.name}".`)}catch(u){console.error("Magic Color Error creating theme variables:",u),figma.notify(`Error: ${u.message||"Unknown error"}`)}}if(e.type==="create-gradient-style"){let{gradient:r}=e;try{let i=`gradient/${r.type}/${r.name.toLowerCase().replace(/\s+/g,"-")}`,f=(yield figma.getLocalPaintStylesAsync()).find(m=>m.name===i);f||(f=figma.createPaintStyle(),f.name=i);let d=r.stops.map(m=>{let{r:b,g:k,b:g}=U(m.color),I=(ne.default||ne)(m.color).alpha();return{color:{r:b,g:k,b:g,a:I},position:m.position/100}}),u=[[1,0,0],[0,1,0]];if(r.type==="linear"){let m=(r.angle||180)*(Math.PI/180),b=Math.cos(m),k=Math.sin(m);u=[[b,k,0],[-k,b,0]]}f.paints=[{type:r.type==="linear"?"GRADIENT_LINEAR":r.type==="radial"?"GRADIENT_RADIAL":"GRADIENT_ANGULAR",gradientStops:d,gradientTransform:u}],figma.notify(`Created gradient style: ${i}`)}catch(i){console.error(i),figma.notify(`Error creating gradient: ${i.message}`)}}if(e.type==="create-gradient-variables"){if(!figma.variables){figma.notify("Error: Variables API not available.");return}let{gradient:r}=e,i=`gradient/${r.type}/${r.name.toLowerCase().replace(/\s+/g,"-")}`;try{let f=(yield figma.variables.getLocalVariableCollectionsAsync()).find(m=>m.name==="ProColorsGradients");f||(f=figma.variables.createVariableCollection("ProColorsGradients"));let d=f.modes[0].modeId,u=0;for(let m=0;m<r.stops.length;m++){let b=r.stops[m],k=`${i}/stop-${m}-${b.position}`,v=(yield figma.variables.getLocalVariablesAsync()).find(x=>x.name===k&&x.variableCollectionId===f.id);v||(v=figma.variables.createVariable(k,f,"COLOR"));let{r:I,g:h,b:S}=U(b.color);v.setValueForMode(d,{r:I,g:h,b:S,a:1}),u++}figma.notify(`Created ${u} variables for gradient stops.`)}catch(l){console.error(l),figma.notify(`Error creating variables: ${l.message}`)}}if(e.type==="get-export-options")try{let r=yield figma.getLocalPaintStylesAsync(),i=figma.variables?yield figma.variables.getLocalVariableCollectionsAsync():[],l=new Set;r.forEach(f=>{if(f.name.includes("/")){let d=f.name.split("/");l.add(d[0])}else l.add("(Root)")}),figma.ui.postMessage({type:"export-options-response",collections:i.map(f=>({id:f.id,name:f.name})),styleGroups:Array.from(l)})}catch(r){console.error(r),figma.ui.postMessage({type:"export-options-response",collections:[],styleGroups:[]})}if(e.type==="export-all-data")try{let{selectedCollectionIds:r=[],selectedStyleGroups:i=[]}=e,l=yield figma.getLocalPaintStylesAsync(),f=yield figma.variables.getLocalVariablesAsync(),d=yield figma.variables.getLocalVariableCollectionsAsync(),u=f;r.length>0&&(u=f.filter(k=>r.includes(k.variableCollectionId)));let m=l;i.length>0&&(m=l.filter(k=>{if(k.name.includes("/")){let g=k.name.split("/")[0];return i.includes(g)}else return i.includes("(Root)")}));let b={variables:u.map(k=>{let g=d.find(S=>S.id===k.variableCollectionId),v=g==null?void 0:g.modes[0].modeId,I=v?k.valuesByMode[v]:null,h=I;return I&&typeof I=="object"&&"r"in I&&(h=ce(I.r,I.g,I.b)),{name:k.name,type:k.resolvedType,collection:(g==null?void 0:g.name)||"Unknown",value:h}}),styles:m.map(k=>{var v;let g=null;if(k.paints.length>0&&k.paints[0].type==="SOLID"){let{r:I,g:h,b:S}=k.paints[0].color;g=ce(I,h,S)}return{name:k.name,description:k.description,type:((v=k.paints[0])==null?void 0:v.type)||"SOLID",value:g}})};figma.ui.postMessage({type:"export-data-success",data:b,fileName:figma.root.name})}catch(r){console.error(r),figma.notify("Export failed: "+r.message)}if(e.type==="import-data"){let{data:r}=e;try{let i=0,l=0;if(r.variables&&r.variables.length>0&&figma.variables){let d=(yield figma.variables.getLocalVariableCollectionsAsync()).find(b=>b.name==="ProColors Imported");d||(d=figma.variables.createVariableCollection("ProColors Imported"));let u=d.modes[0].modeId,m=yield figma.variables.getLocalVariablesAsync();for(let b of r.variables)if(b.type==="COLOR"&&b.value){let k=m.find(g=>g.name===b.name&&g.variableCollectionId===d.id);k||(k=figma.variables.createVariable(b.name,d,"COLOR"));try{let{r:g,g:v,b:I}=U(b.value);k.setValueForMode(u,{r:g,g:v,b:I,a:1}),i++}catch(g){}}}if(r.styles&&r.styles.length>0){let f=yield figma.getLocalPaintStylesAsync();for(let d of r.styles)if(d.type==="SOLID"&&d.value){let u=f.find(g=>g.name===d.name);u||(u=figma.createPaintStyle(),u.name=d.name);let{r:m,g:b,b:k}=U(d.value);u.paints=[{type:"SOLID",color:{r:m,g:b,b:k}}],u.description=d.description||"Imported by ProColors",l++}}figma.notify(`Imported: ${i} variables, ${l} styles.`),figma.ui.postMessage({type:"import-data-finished"})}catch(i){console.error(i),figma.notify("Import failed: "+i.message),figma.ui.postMessage({type:"import-data-finished"})}}if(e.type,e.type==="get-mesh-variable-collections"){if(!figma.variables){figma.ui.postMessage({type:"mesh-variable-collections-response",collections:[]});return}try{let i=(yield figma.variables.getLocalVariableCollectionsAsync()).map(l=>({id:l.id,name:l.name}));figma.ui.postMessage({type:"mesh-variable-collections-response",collections:i})}catch(r){console.error("Error fetching collections for mesh:",r),figma.ui.postMessage({type:"mesh-variable-collections-response",collections:[]})}}if(e.type==="get-mesh-variables-from-collection"){if(!figma.variables)return;let{collectionId:r}=e;try{let i=yield figma.variables.getVariableCollectionByIdAsync(r);if(!i){figma.notify("Collection not found");return}let l=i.modes[0].modeId,u=(yield figma.variables.getLocalVariablesAsync()).filter(m=>m.variableCollectionId===r&&m.resolvedType==="COLOR").map(m=>{let b=m.valuesByMode[l];return b&&typeof b=="object"&&"r"in b?ce(b.r,b.g,b.b):null}).filter(m=>m!==null);figma.ui.postMessage({type:"mesh-variables-response",colors:u})}catch(i){console.error("Error fetching variables for mesh:",i),figma.notify("Error fetching variables")}}if(e.type==="replace-colors"){let d=function(u){if("fills"in u,"children"in u)for(let m of u.children)d(m);f++};var t=d;let{scope:r,target:i}=e,l=[];r==="selection"?l=[...figma.currentPage.selection]:l=[...figma.currentPage.children];let f=0;l.forEach(d),figma.notify(`Scanned ${f} nodes. Color replacement requires active palette mapping (Not fully implemented in MVP).`)}if(e.type==="link-colors")try{let{scope:r,preference:i,threshold:l}=e,f=l!==void 0?l:10;if(r==="selection"||!r){let d=figma.currentPage.selection;if(d.length===0){figma.ui.postMessage({type:"link-colors-error",error:"Please select a frame or component to begin."});return}let u=yield sn(d,i,f);if(console.log(`Linking complete: ${u.totalReplaced} of ${u.totalScanned} colors replaced`),u.totalReplaced>0)figma.notify(`\u2713 Successfully linked ${u.totalReplaced} colors to ${i||"variables/styles"}`);else if(u.totalScanned>0){let m=u.results.filter(I=>!I.success),b={};m.forEach(I=>{let h=I.error||"Unknown error";b[h]=(b[h]||0)+1});let k=Object.entries(b).sort((I,h)=>h[1]-I[1])[0],g=k?k[0]:"Unknown",v=`\u26A0 Linked 0 colors. Issue: ${g}`;g.includes("Failed to apply variable")&&(v+=". Make sure variables are local (not remote) and you have edit access."),figma.notify(v),console.error("Failed replacements:",m.slice(0,10)),console.error("Error breakdown:",b)}else figma.notify("No unlinked colors found in selection");figma.ui.postMessage({type:"link-colors-result",result:u})}else if(r==="page"){let d=l!==void 0?l:10,u=yield ln(figma.currentPage,i,d);figma.ui.postMessage({type:"link-colors-result",result:u})}}catch(r){console.error("Error linking colors:",r),figma.ui.postMessage({type:"link-colors-error",error:r.message||"Unknown error occurred"})}if(e.type==="undo-linking")try{let{undoStates:r}=e;yield cn(r),figma.notify("Changes undone successfully")}catch(r){console.error("Error undoing linking:",r),figma.notify(`Error undoing: ${r.message||"Unknown error"}`)}if(e.type==="add-palette-to-canvas"){let{palettes:r}=e;try{yield figma.loadFontAsync({family:"Inter",style:"Regular"}),yield figma.loadFontAsync({family:"Inter",style:"Bold"});let i=80,l=12,f=16,d=figma.createFrame();d.name="ProColorTokens",d.fills=[{type:"SOLID",color:{r:.97,g:.97,b:.98}}],d.layoutMode="VERTICAL",d.primaryAxisSizingMode="AUTO",d.counterAxisSizingMode="AUTO",d.paddingLeft=24,d.paddingRight=24,d.paddingTop=24,d.paddingBottom=24,d.itemSpacing=16,d.counterAxisAlignItems="MIN";let u=figma.createText();u.characters="ProColorTokens",u.fontSize=24,u.fontName={family:"Inter",style:"Bold"},u.resize(400,32),d.appendChild(u);let m=figma.createText();m.characters="Color palette generate with ProColors plugin.",m.fontSize=14,m.fontName={family:"Inter",style:"Regular"},m.resize(400,20),d.appendChild(m);let b=figma.createFrame();b.name="Color Grid",b.fills=[],b.layoutMode="VERTICAL",b.primaryAxisSizingMode="AUTO",b.counterAxisSizingMode="AUTO",b.paddingLeft=0,b.paddingRight=0,b.paddingTop=0,b.paddingBottom=0,b.itemSpacing=f,b.counterAxisAlignItems="MIN",d.appendChild(b);let k=Object.entries(r).sort(([v],[I])=>{let h=["primary","secondary","neutral","success","warning","error","info"],S=h.indexOf(v.toLowerCase()),x=h.indexOf(I.toLowerCase());return S===-1&&x===-1?v.localeCompare(I):S===-1?1:x===-1?-1:S-x});for(let[v,I]of k){let h=figma.createFrame();h.name=`${v} Group`,h.fills=[],h.layoutMode="VERTICAL",h.primaryAxisSizingMode="AUTO",h.counterAxisSizingMode="AUTO",h.paddingLeft=0,h.paddingRight=0,h.paddingTop=0,h.paddingBottom=0,h.itemSpacing=12,h.counterAxisAlignItems="MIN",b.appendChild(h);try{let w=figma.createText(),p=v.charAt(0).toUpperCase()+v.slice(1);w.characters=p,w.fontSize=16,w.fontName={family:"Inter",style:"Bold"},w.resize(200,22),w.fills=[{type:"SOLID",color:{r:.12,g:.12,b:.12}}],h.appendChild(w)}catch(w){}let S=figma.createFrame();S.name=v,S.fills=[],S.layoutMode="HORIZONTAL",S.primaryAxisSizingMode="AUTO",S.counterAxisSizingMode="AUTO",S.paddingLeft=0,S.paddingRight=0,S.paddingTop=0,S.paddingBottom=0,S.itemSpacing=l,S.counterAxisAlignItems="CENTER",h.appendChild(S);let x=[...I].sort((w,p)=>{let A=typeof w.shade=="number"?w.shade:parseInt(w.shade.toString()),L=typeof p.shade=="number"?p.shade:parseInt(p.shade.toString());return A-L});for(let w of x){let p=figma.createFrame();p.name=`${v}-${w.shade}`,p.fills=[],p.layoutMode="VERTICAL",p.primaryAxisSizingMode="FIXED",p.counterAxisSizingMode="FIXED",p.layoutGrow=0,p.paddingLeft=0,p.paddingRight=0,p.paddingTop=0,p.paddingBottom=0,p.itemSpacing=6,p.counterAxisAlignItems="CENTER",p.resize(i,i+24);let A=figma.createRectangle(),{r:L,g:y,b:E}=U(w.value);A.fills=[{type:"SOLID",color:{r:L,g:y,b:E}}],A.resize(i,i),A.cornerRadius=8,p.appendChild(A);try{let $=figma.createText();$.characters=`${v}-${w.shade}`,$.fontSize=11,$.fontName={family:"Inter",style:"Regular"},$.resize(i,18),$.textAlignHorizontal="CENTER",p.appendChild($)}catch($){}S.appendChild(p)}}figma.currentPage.appendChild(d),figma.currentPage.selection=[d],figma.viewport.scrollAndZoomIntoView([d]);let g=Object.values(r).reduce((v,I)=>v+I.length,0);figma.notify(`Added color palette with ${Object.keys(r).length} groups (${g} swatches) to canvas`)}catch(i){console.error("Error adding palette to canvas:",i),figma.notify(`Error: ${i.message||"Failed to add palette to canvas"}`)}}if(e.type==="notify"&&figma.notify(e.message),e.type==="fetch-webpage"){let{url:r}=e;try{let i=r.trim();!i.startsWith("http://")&&!i.startsWith("https://")&&(i="https://"+i);let l=yield fetch(i,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);let f=yield l.text();figma.ui.postMessage({type:"webpage-html-response",html:f,url:i})}catch(i){console.error("Error fetching webpage:",i),figma.ui.postMessage({type:"webpage-html-response",error:i.message||"Failed to fetch webpage"})}}if(e.type==="explore-add-variables"){if(!figma.variables){figma.notify("Error: Variables API not available.");return}let{palette:r}=e;try{let l=(yield figma.variables.getLocalVariableCollectionsAsync()).find(m=>m.name==="Explore Palettes");l||(l=figma.variables.createVariableCollection("Explore Palettes"));let f=l.modes[0].modeId,d=yield figma.variables.getLocalVariablesAsync(),u=0;for(let m=0;m<r.colors.length;m++){let b=r.colors[m],k=`${r.name}-${m+1}`,g=d.find(S=>S.name===k&&S.variableCollectionId===l.id);g||(g=figma.variables.createVariable(k,l,"COLOR"));let{r:v,g:I,b:h}=U(b);g.setValueForMode(f,{r:v,g:I,b:h,a:1}),u++}figma.notify(`Added ${u} variables to "Explore Palettes" collection.`)}catch(i){console.error(i),figma.notify(`Error creating variables: ${i.message}`)}}if(e.type==="explore-add-styles"){let{palette:r}=e;try{let i=yield figma.getLocalPaintStylesAsync(),l=0;for(let f=0;f<r.colors.length;f++){let d=r.colors[f],u=`${r.name}/${f+1}`,m=`${r.name}-${f+1}`,b=i.find(I=>I.name===m);b||(b=figma.createPaintStyle(),b.name=m);let{r:k,g,b:v}=U(d);b.paints=[{type:"SOLID",color:{r:k,g,b:v}}],l++}figma.notify(`Created ${l} color styles.`)}catch(i){console.error(i),figma.notify(`Error creating styles: ${i.message}`)}}if(e.type==="save-settings")try{let r=e.settings;console.log("Saving settings to clientStorage:",r),yield figma.clientStorage.setAsync("procolors-settings",r),console.log("Settings saved successfully to clientStorage"),figma.ui.postMessage({type:"settings-saved",success:!0})}catch(r){console.error("Error saving settings:",r),figma.ui.postMessage({type:"settings-saved",success:!1,error:r.message})}if(e.type==="get-settings")try{let r=yield figma.clientStorage.getAsync("procolors-settings");figma.ui.postMessage({type:"settings-loaded",settings:r||null})}catch(r){console.error("Error loading settings:",r),figma.ui.postMessage({type:"settings-loaded",settings:null,error:r.message})}if(e.type==="clear-settings")try{yield figma.clientStorage.setAsync("procolors-settings",null),figma.ui.postMessage({type:"settings-cleared",success:!0})}catch(r){console.error("Error clearing settings:",r),figma.ui.postMessage({type:"settings-cleared",success:!1,error:r.message})}if(e.type==="save-brands")try{let r=e.brands;console.log("Saving brands to clientStorage:",r),yield figma.clientStorage.setAsync("procolors-brands",r),console.log("Brands saved successfully to clientStorage"),figma.ui.postMessage({type:"brands-saved",success:!0})}catch(r){console.error("Error saving brands:",r),figma.ui.postMessage({type:"brands-saved",success:!1,error:r.message})}if(e.type==="get-brands")try{let r=yield figma.clientStorage.getAsync("procolors-brands");figma.ui.postMessage({type:"brands-loaded",brands:r||null})}catch(r){console.error("Error loading brands:",r),figma.ui.postMessage({type:"brands-loaded",brands:null,error:r.message})}if(e.type==="save-active-brand-id")try{let r=e.brandId;console.log("Saving active brand ID to clientStorage:",r),yield figma.clientStorage.setAsync("procolors-active-brand-id",r),console.log("Active brand ID saved successfully to clientStorage"),figma.ui.postMessage({type:"active-brand-id-saved",success:!0})}catch(r){console.error("Error saving active brand ID:",r),figma.ui.postMessage({type:"active-brand-id-saved",success:!1,error:r.message})}if(e.type==="get-active-brand-id")try{let r=yield figma.clientStorage.getAsync("procolors-active-brand-id");figma.ui.postMessage({type:"active-brand-id-loaded",brandId:r||null})}catch(r){console.error("Error loading active brand ID:",r),figma.ui.postMessage({type:"active-brand-id-loaded",brandId:null,error:r.message})}if(e.type==="scan-colors"){let{scope:r,threshold:i}=e;try{let d=function(m,b=""){let k=b?`${b}/${m.name}`:m.name;"fills"in m&&Array.isArray(m.fills)&&m.fills.forEach(g=>{if(g.type==="SOLID"){let v=ce(g.color.r,g.color.g,g.color.b),I=f.get(v);I?(I.count++,I.locations.includes(k)||I.locations.push(k)):f.set(v,{count:1,locations:[k]})}}),"strokes"in m&&Array.isArray(m.strokes)&&m.strokes.forEach(g=>{if(g.type==="SOLID"){let v=ce(g.color.r,g.color.g,g.color.b),I=f.get(v);I?(I.count++,I.locations.includes(k)||I.locations.push(k)):f.set(v,{count:1,locations:[k]})}}),"children"in m&&m.children.forEach(g=>{d(g,k)})};var o=d;let l=[];if(r==="selection"){if(l=[...figma.currentPage.selection],l.length===0){figma.ui.postMessage({type:"scan-colors-result",colors:[],error:"No selection found. Please select at least one element."});return}}else if(r==="page"){if(l=[...figma.currentPage.children],l.length===0){figma.ui.postMessage({type:"scan-colors-result",colors:[],error:"Current page is empty."});return}}else if(r==="file"&&(console.log("Loading all pages..."),yield figma.loadAllPagesAsync(),console.log("All pages loaded"),figma.root.children.forEach(m=>{m.type==="PAGE"&&l.push(...m.children)}),l.length===0)){figma.ui.postMessage({type:"scan-colors-result",colors:[],error:"File is empty."});return}let f=new Map;l.forEach(m=>d(m));let u=Array.from(f.entries()).map(([m,b])=>({color:m,count:b.count,locations:b.locations.slice(0,10)}));console.log("Sending scan-colors-result:",{colorsCount:u.length}),figma.ui.postMessage({type:"scan-colors-result",colors:u})}catch(l){console.error("Error scanning colors:",l),figma.ui.postMessage({type:"scan-colors-result",colors:[],error:l.message})}}if(e.type==="create-semantic-tokens"){if(console.log("=== CREATE SEMANTIC TOKENS HANDLER ==="),console.log("Semantic tokens count:",(s=e.semanticTokens)==null?void 0:s.length),console.log("Collection ID:",e.collectionId),!figma.variables){console.error("Variables API not available"),figma.notify("Error: Variables API is not available.");return}let{semanticTokens:r,baseTokens:i,collectionId:l}=e,f=0,d=0;try{let u=yield figma.variables.getLocalVariableCollectionsAsync();console.log("Available collections:",u.map(h=>({id:h.id,name:h.name})));let m=u.find(h=>h.id===l);if(!m){console.error("Collection not found:",l),figma.notify("Error: Collection not found.");return}console.log("Using collection:",m.name);let b=m.modes[0].modeId,g=(yield figma.variables.getLocalVariablesAsync()).filter(h=>h.variableCollectionId===m.id),v=new Map(g.map(h=>[h.name,h])),I=new Map;g.forEach(h=>{h.name.startsWith("Base Tokens/")&&I.set(h.name,h)});for(let h of r)try{let S=h.name.replace(/\./g,"/");console.log(`Creating token: "${h.name}" -> "${S}"`);let x=v.get(S);if(x?console.log(`Variable already exists: ${S}`):(x=figma.variables.createVariable(S,m,"COLOR"),v.set(S,x),console.log(`\u2713 Created variable: ${S}`)),h.aliasTo){let w=I.get(h.aliasTo);if(w)x.setValueForMode(b,{type:"VARIABLE_ALIAS",id:w.id}),console.log(`\u2713 Set alias for ${S} to ${h.aliasTo}`);else if(console.warn(`Alias source not found: ${h.aliasTo}, using direct value`),h.value){let{r:p,g:A,b:L}=U(h.value);x.setValueForMode(b,{r:p,g:A,b:L,a:1})}}else if(h.value){let{r:w,g:p,b:A}=U(h.value);x.setValueForMode(b,{r:w,g:p,b:A,a:1}),console.log(`\u2713 Set direct value for ${S}: ${h.value}`)}f++}catch(S){console.error(`Failed to create semantic token ${h.name}:`,S),console.error("Error details:",S.message,S.stack),d++}console.log(`Completed: ${f} created, ${d} failed`),d>0?figma.notify(`Created ${f} semantic tokens. Failed: ${d}.`):figma.notify(`Success! Created ${f} semantic tokens.`)}catch(u){console.error("Error creating semantic tokens:",u),figma.notify(`Error: ${u.message||"Unknown error"}`)}}if(e.type==="create-token-snapshot"){let{tokens:r,semanticTokens:i,name:l,description:f}=e;try{let d={id:`snapshot-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),name:l||`Snapshot ${new Date().toLocaleString()}`,description:f,tokens:r,semanticTokens:i},u=(yield figma.clientStorage.getAsync("token-snapshots"))||[];u.push(d),yield figma.clientStorage.setAsync("token-snapshots",u),figma.ui.postMessage({type:"token-snapshot-created",snapshot:d}),figma.notify(`Snapshot "${d.name}" created successfully.`)}catch(d){console.error("Error creating snapshot:",d),figma.ui.postMessage({type:"token-snapshot-error",error:d.message})}}if(e.type==="get-token-snapshots")try{let r=(yield figma.clientStorage.getAsync("token-snapshots"))||[];figma.ui.postMessage({type:"token-snapshots-loaded",snapshots:r})}catch(r){console.error("Error loading snapshots:",r),figma.ui.postMessage({type:"token-snapshots-loaded",snapshots:[]})}if(e.type==="create-variables-from-colors"){console.log("=== CREATE VARIABLES HANDLER CALLED ==="),console.log("Received create-variables-from-colors request:",{colorsCount:(c=e.colors)==null?void 0:c.length,collectionId:e.collectionId,createNewCollection:e.createNewCollection,hasColors:!!e.colors}),G(null,null,function*(){let r=!1,i=f=>{if(r){console.warn("Response already sent, ignoring duplicate");return}r=!0,console.log("Sending response:",f),figma.ui.postMessage(f)},l=setTimeout(()=>{r||(console.error("Handler timeout - sending error response"),i({type:"create-variables-from-colors-result",success:!1,error:"Handler timeout - operation took too long"}))},25e3);try{if(!figma.variables){console.error("Variables API not available"),i({type:"create-variables-from-colors-result",success:!1,error:"Variables API is not available in this file."});return}if(!e.colors||!Array.isArray(e.colors)||e.colors.length===0){console.error("No colors provided"),i({type:"create-variables-from-colors-result",success:!1,error:"No colors provided to create variables."});return}let{colors:f,collectionId:d,createNewCollection:u}=e,m=0,b=0;console.log("Getting collections...");let k=yield figma.variables.getLocalVariableCollectionsAsync();console.log("Found collections:",k.length);let g;if(console.log("Collection decision:",{createNewCollection:u,collectionId:d,hasCollectionId:!!d}),u||!d||d===null){let w=new Date().toLocaleString("en-GB",{month:"short",day:"numeric",hour:"numeric",minute:"numeric"});console.log("Creating new collection...");try{g=figma.variables.createVariableCollection(`Extracted Colors (${w})`),console.log("\u2713 Created new collection:",g.name,"ID:",g.id)}catch(p){throw console.error("Failed to create collection:",p),new Error(`Failed to create collection: ${p.message}`)}}else if(d)if(console.log("Looking for collection with ID:",d),console.log("Available collections:",k.map(w=>({id:w.id,name:w.name}))),g=k.find(w=>w.id===d),g)console.log("\u2713 Using existing collection:",g.name);else{console.error("Collection not found:",d),i({type:"create-variables-from-colors-result",success:!1,error:"Selected collection not found."});return}if(!g)throw new Error("Could not determine variable collection.");let v=g.modes[0].modeId;console.log("Mode ID:",v);let h=(yield figma.variables.getLocalVariablesAsync()).filter(w=>w.variableCollectionId===g.id),S=new Map(h.map(w=>[w.name,w]));console.log(`Processing ${f.length} colors...`);for(let w of f)try{let{color:p,name:A}=w;if(!p||!A){console.error("Invalid color data:",w),b++;continue}console.log(`Creating variable: ${A} with color: ${p}`);let L=S.get(A);if(L)console.log(`Variable already exists: ${A}, updating value`);else try{L=figma.variables.createVariable(A,g,"COLOR"),S.set(A,L),console.log(`Created new variable: ${A}`)}catch(y){throw console.error(`Error creating variable ${A}:`,y),y}try{let{r:y,g:E,b:$}=U(p),O={r:y,g:E,b:$,a:1};L.setValueForMode(v,O),console.log(`Set value for ${A}:`,O),m++}catch(y){throw console.error(`Error setting value for ${A}:`,y),y}}catch(p){console.error(`Failed to create variable ${w.name}:`,p),console.error("Error details:",p.message,p.stack),b++}console.log("Variable creation complete:",{count:m,errorCount:b,collectionName:g.name});let x=b>0?{type:"create-variables-from-colors-result",success:!0,count:m,error:`Created ${m} variables. Failed: ${b}.`}:{type:"create-variables-from-colors-result",success:!0,count:m};clearTimeout(l),i(x),b===0&&figma.notify(`Success! Created ${m} color variables in "${g.name}".`),console.log("=== RESPONSE SENT TO UI ===")}catch(f){clearTimeout(l),console.error("=== ERROR IN CREATE VARIABLES HANDLER ==="),console.error("Error creating variables from colors:",f),console.error("Error name:",f.name),console.error("Error message:",f.message),console.error("Error stack:",f.stack),i({type:"create-variables-from-colors-result",success:!1,error:f.message||"Unknown error"}),console.log("Error response sent to UI")}});return}if(e.type==="create-mode-variables"){if(console.log("=== CREATE MODE VARIABLES HANDLER ==="),console.log("Received data:",{hasModeTokens:!!e.modeTokens,hasModeTokensByMode:!!e.modeTokensByMode,collectionName:e.collectionName,collectionId:e.collectionId,createNewCollection:e.createNewCollection}),!figma.variables){figma.ui.postMessage({type:"create-mode-variables-result",success:!1,error:"Variables API is not available in this file."});return}G(null,null,function*(){var r,i,l;try{let f=e.modeTokensByMode||e.modeTokens,d=["light","dark","high-contrast"];if(!f)throw new Error("No mode tokens provided");console.log("Mode tokens received:",{light:((r=f.light)==null?void 0:r.length)||0,dark:((i=f.dark)==null?void 0:i.length)||0,"high-contrast":((l=f["high-contrast"])==null?void 0:l.length)||0});let u,m=yield figma.variables.getLocalVariableCollectionsAsync();if(e.createNewCollection||!e.collectionId){let p=new Date().toLocaleString("en-GB",{month:"short",day:"numeric",hour:"numeric",minute:"numeric"}),A=e.collectionName||`Multi-Mode Tokens (${p})`;u=figma.variables.createVariableCollection(A),console.log("Created new collection:",u.name)}else{let p=m.find(A=>A.id===e.collectionId);if(!p)throw new Error(`Collection with ID ${e.collectionId} not found`);u=p,console.log("Using existing collection:",u.name)}let b,k,g;if(e.createNewCollection||!e.collectionId){b=u.modes[0].modeId,u.renameMode(b,"Light");let p=u.addMode("Dark"),A=u.addMode("High Contrast");k=p.modeId,g=A.modeId,console.log("Created new modes:",{lightModeId:b,darkModeId:k,highContrastModeId:g})}else{let p=u.modes,A=p.find(E=>E.name.toLowerCase()==="light")||p[0],L=p.find(E=>E.name.toLowerCase()==="dark"),y=p.find(E=>E.name.toLowerCase().includes("contrast"));L||(L=u.addMode("Dark"),console.log("Added Dark mode to existing collection")),y||(y=u.addMode("High Contrast"),console.log("Added High Contrast mode to existing collection")),b=A.modeId,k=L.modeId,g=y.modeId,console.log("Using existing modes:",{lightModeId:b,darkModeId:k,highContrastModeId:g})}let v={light:b,dark:k,"high-contrast":g},I=new Map,h=0,S=f.light||[];if(S.length===0)throw new Error("No light mode tokens found. Please generate tokens first.");console.log(`Creating ${S.length} variables...`);for(let p of S)try{let A=figma.variables.createVariable(p.name,u,"COLOR");I.set(p.name,A),h++;for(let L of d){let y=v[L],E=(f[L]||[]).find($=>$.name===p.name);if(E){let{r:$,g:O,b:N}=U(E.value);A.setValueForMode(y,{r:$,g:O,b:N,a:1}),console.log(`Set ${p.name} for ${L}:`,E.value)}}}catch(A){console.error(`Error creating variable ${p.name}:`,A)}console.log(`Created ${h} mode variables with ${d.length} modes`),console.log("Variable map contains:",Array.from(I.keys()));let x=0;if(e.createSemanticTokens&&e.semanticTokensByMode){console.log("Creating semantic tokens as aliases...");let p=e.semanticTokensByMode,A=p.light||[];console.log(`Creating ${A.length} semantic tokens...`),console.log("Sample semantic token:",A[0]);for(let L of A)try{let y=L.name.replace(/\./g,"/"),E=figma.variables.createVariable(y,u,"COLOR");for(let $ of d){let O=v[$],N=(p[$]||[]).find(D=>D.name===L.name);if(console.log(`Processing ${y} for ${$}:`,{hasToken:!!N,aliasTo:N==null?void 0:N.aliasTo,value:N==null?void 0:N.value,hasBaseVar:!!I.get((N==null?void 0:N.aliasTo)||"")}),N&&N.aliasTo){let D=I.get(N.aliasTo);if(D)E.setValueForMode(O,{type:"VARIABLE_ALIAS",id:D.id}),console.log(`\u2713 Set semantic ${y} for ${$} as alias to: ${N.aliasTo}`);else{console.warn(`\u2717 Base token "${N.aliasTo}" not found in map (available: ${Array.from(I.keys()).slice(0,5).join(", ")}...), using direct value`);let{r:F,g:X,b:Y}=U(N.value);E.setValueForMode(O,{r:F,g:X,b:Y,a:1})}}else if(N){console.log(`No alias info for ${y}, using direct value`);let{r:D,g:F,b:X}=U(N.value);E.setValueForMode(O,{r:D,g:F,b:X,a:1}),console.log(`Set semantic ${y} for ${$} (direct value):`,N.value)}}x++}catch(y){console.error(`Error creating semantic token ${L.name}:`,y),console.error("Error details:",y.message)}console.log(`Created ${x} semantic tokens as aliases`)}let w=h+x;figma.ui.postMessage({type:"create-mode-variables-result",success:!0,count:h,semanticCount:x,modes:d.length}),x>0?figma.notify(`Success! Created ${h} mode variables and ${x} semantic tokens with ${d.length} modes in "${u.name}".`):figma.notify(`Success! Created ${h} variables with ${d.length} modes in "${u.name}".`)}catch(f){console.error("=== ERROR IN CREATE MODE VARIABLES ==="),console.error("Error:",f),console.error("Error message:",f.message),console.error("Error stack:",f.stack),figma.ui.postMessage({type:"create-mode-variables-result",success:!1,error:f.message||"Unknown error"}),figma.notify(`Error creating mode variables: ${f.message}`)}});return}if(e.type==="export-documentation-to-canvas"){G(null,null,function*(){try{let r=e.data;if(console.log("Creating documentation in Figma canvas...",r),!r||!r.categories)throw new Error("Invalid data received. Please try again.");let i=r.palettes||{},l={family:"Roboto",style:"Bold"},f={family:"Roboto",style:"Medium"},d={family:"Roboto",style:"Medium"},u={family:"Roboto",style:"Regular"};try{yield figma.loadFontAsync({family:"Inter",style:"Bold"}),l={family:"Inter",style:"Bold"}}catch(g){yield figma.loadFontAsync(l)}try{yield figma.loadFontAsync({family:"Inter",style:"Semi Bold"}),f={family:"Inter",style:"Semi Bold"}}catch(g){try{yield figma.loadFontAsync({family:"Inter",style:"SemiBold"}),f={family:"Inter",style:"SemiBold"}}catch(v){yield figma.loadFontAsync(f)}}try{yield figma.loadFontAsync({family:"Inter",style:"Medium"}),d={family:"Inter",style:"Medium"}}catch(g){yield figma.loadFontAsync(d)}try{yield figma.loadFontAsync({family:"Inter",style:"Regular"}),u={family:"Inter",style:"Regular"}}catch(g){yield figma.loadFontAsync(u)}let m=figma.createFrame();m.name=r.title||"Color Documentation",m.resize(1440,100),m.fills=[{type:"GRADIENT_LINEAR",gradientTransform:[[1,0,0],[0,1,0]],gradientStops:[{position:0,color:{r:.97,g:.98,b:1,a:1}},{position:1,color:{r:.93,g:.96,b:1,a:1}}]}],m.layoutMode="VERTICAL",m.primaryAxisSizingMode="AUTO",m.counterAxisSizingMode="FIXED",m.itemSpacing=56,m.paddingLeft=72,m.paddingRight=72,m.paddingTop=72,m.paddingBottom=72,m.cornerRadius=32,m.effects=[{type:"DROP_SHADOW",color:{r:.15,g:.23,b:.35,a:.15},offset:{x:0,y:16},radius:64,spread:-8,visible:!0,blendMode:"NORMAL"}];let b=figma.createFrame();b.name="Header",b.resize(1296,100),b.fills=[{type:"GRADIENT_LINEAR",gradientTransform:[[.9,-.5,.45],[.5,.9,-.15]],gradientStops:[{position:0,color:{r:.15,g:.42,b:.93,a:1}},{position:1,color:{r:.52,g:.27,b:.95,a:1}}]}],b.cornerRadius=24,b.layoutMode="VERTICAL",b.primaryAxisSizingMode="AUTO",b.counterAxisSizingMode="FIXED",b.itemSpacing=16,b.paddingLeft=48,b.paddingRight=48,b.paddingTop=48,b.paddingBottom=48,b.effects=[{type:"DROP_SHADOW",color:{r:.15,g:.4,b:.92,a:.3},offset:{x:0,y:12},radius:40,spread:0,visible:!0,blendMode:"NORMAL"},{type:"DROP_SHADOW",color:{r:.15,g:.4,b:.92,a:.15},offset:{x:0,y:4},radius:12,spread:0,visible:!0,blendMode:"NORMAL"}];let k=figma.createText();if(k.fontName=l,k.fontSize=64,k.characters=r.title||"Color Documentation",k.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],k.letterSpacing={value:-2.5,unit:"PERCENT"},k.lineHeight={value:110,unit:"PERCENT"},b.appendChild(k),r.subtitle){let g=figma.createText();g.fontName=u,g.fontSize=22,g.characters=r.subtitle,g.fills=[{type:"SOLID",color:{r:1,g:1,b:1},opacity:.92}],g.lineHeight={value:160,unit:"PERCENT"},b.appendChild(g)}if(r.brandName||r.version||r.author){let g=figma.createFrame();g.name="Metadata",g.resize(1200,30),g.fills=[],g.layoutMode="HORIZONTAL",g.primaryAxisSizingMode="AUTO",g.counterAxisSizingMode="AUTO",g.itemSpacing=10;let v=[];r.brandName&&v.push(r.brandName),r.version&&v.push(`v${r.version}`),r.author&&v.push(r.author),v.push(r.generatedDate);for(let I of v){let h=figma.createFrame();h.resize(100,36),h.fills=[{type:"SOLID",color:{r:1,g:1,b:1},opacity:.24}],h.cornerRadius=10,h.layoutMode="HORIZONTAL",h.primaryAxisSizingMode="AUTO",h.counterAxisSizingMode="AUTO",h.paddingLeft=16,h.paddingRight=16,h.paddingTop=8,h.paddingBottom=8,h.itemSpacing=8;let S=figma.createText();S.fontName=d,S.fontSize=14,S.characters=I,S.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],h.appendChild(S),g.appendChild(h)}b.appendChild(g)}m.appendChild(b);for(let g of r.categories){let v=figma.createFrame();v.name=g.name+" Colors",v.resize(1296,100),v.fills=[],v.layoutMode="VERTICAL",v.primaryAxisSizingMode="AUTO",v.counterAxisSizingMode="FIXED",v.itemSpacing=28;let I=figma.createText();I.fontName=l,I.fontSize=40,I.characters=g.name+" Colors",I.fills=[{type:"SOLID",color:{r:.08,g:.09,b:.18}}],I.letterSpacing={value:-2,unit:"PERCENT"},v.appendChild(I);let h=figma.createFrame();h.name="Color Grid",h.resize(1296,100),h.fills=[],h.layoutMode="HORIZONTAL",h.primaryAxisSizingMode="AUTO",h.counterAxisSizingMode="AUTO",h.itemSpacing=r.layout==="compact"?20:24,h.layoutWrap="WRAP";for(let S of g.colors){let x=figma.createFrame();x.name=S.name,x.resize(412,r.layout==="compact"?260:340),x.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],x.cornerRadius=20,x.layoutMode="VERTICAL",x.primaryAxisSizingMode="AUTO",x.counterAxisSizingMode="FIXED",x.itemSpacing=0,x.strokes=[{type:"SOLID",color:{r:0,g:0,b:0},opacity:.06}],x.strokeWeight=1,x.effects=[{type:"DROP_SHADOW",color:{r:.09,g:.12,b:.2,a:.1},offset:{x:0,y:8},radius:24,spread:-4,visible:!0,blendMode:"NORMAL"},{type:"DROP_SHADOW",color:{r:0,g:0,b:0,a:.05},offset:{x:0,y:2},radius:8,spread:0,visible:!0,blendMode:"NORMAL"}];let w=figma.createFrame();w.name="Swatch",w.resize(412,r.layout==="compact"?120:160);try{let y=U(S.value);w.fills=[{type:"SOLID",color:y}]}catch(y){w.fills=[{type:"SOLID",color:{r:.8,g:.8,b:.8}}]}if(w.cornerRadius=20,w.topLeftRadius=20,w.topRightRadius=20,w.bottomLeftRadius=0,w.bottomRightRadius=0,r.includeCodeSnippets){let y=figma.createFrame();y.resize(100,28),y.fills=[{type:"SOLID",color:{r:0,g:0,b:0},opacity:.4}],y.cornerRadius=8,y.layoutMode="HORIZONTAL",y.primaryAxisSizingMode="AUTO",y.counterAxisSizingMode="AUTO",y.paddingLeft=12,y.paddingRight=12,y.paddingTop=6,y.paddingBottom=6,y.effects=[{type:"DROP_SHADOW",color:{r:0,g:0,b:0,a:.2},offset:{x:0,y:2},radius:8,spread:0,visible:!0,blendMode:"NORMAL"}];let E=figma.createText();E.fontName=d,E.fontSize=13,E.characters=S.value.toUpperCase(),E.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],y.appendChild(E),y.x=16,y.y=r.layout==="compact"?60:100,w.appendChild(y)}x.appendChild(w);let p=figma.createFrame();p.name="Info",p.resize(412,100),p.fills=[],p.layoutMode="VERTICAL",p.primaryAxisSizingMode="AUTO",p.counterAxisSizingMode="FIXED",p.itemSpacing=16,p.paddingLeft=20,p.paddingRight=20,p.paddingTop=20,p.paddingBottom=20;let A=figma.createText();A.fontName=l,A.fontSize=18,A.characters=S.name.charAt(0).toUpperCase()+S.name.slice(1),A.fills=[{type:"SOLID",color:{r:.09,g:.09,b:.15}}],A.letterSpacing={value:-.5,unit:"PERCENT"},p.appendChild(A);let L=S.name.toLowerCase();if(console.log("Looking for shades for:",L,"Available palettes:",Object.keys(i)),i&&i[L]){let y=figma.createFrame();y.name="Shades",y.resize(372,48),y.fills=[],y.layoutMode="HORIZONTAL",y.primaryAxisSizingMode="FIXED",y.counterAxisSizingMode="FIXED",y.itemSpacing=4;let E=i[L];if(console.log("Shades for",L,":",E),E&&typeof E=="object"){let $=Object.keys(E).sort((O,N)=>Number(O)-Number(N));console.log("Shade keys:",$);for(let O of $){let N=E[O];if(console.log("Processing shade:",O,"=",N),!N||typeof N!="string"){console.log("Skipping invalid shade value:",N);continue}let D=figma.createFrame();D.name=`Shade-${O}`,D.resize(28,48),D.cornerRadius=6;try{let F=U(N);console.log("Converted",N,"to RGB:",F),D.fills=[{type:"SOLID",color:F}]}catch(F){console.error("Error converting color:",N,F);continue}D.strokes=[{type:"SOLID",color:{r:0,g:0,b:0},opacity:.1}],D.strokeWeight=1,y.appendChild(D)}y.children.length>0&&p.appendChild(y)}}if(r.includeAccessibility&&S.accessibility){let y=figma.createFrame();y.name="Accessibility",y.resize(372,64),y.fills=[{type:"SOLID",color:{r:.98,g:.98,b:.99}}],y.cornerRadius=8,y.layoutMode="VERTICAL",y.primaryAxisSizingMode="AUTO",y.counterAxisSizingMode="FIXED",y.itemSpacing=10,y.paddingLeft=12,y.paddingRight=12,y.paddingTop=12,y.paddingBottom=12;let E=figma.createText();E.fontName=u,E.fontSize=13,E.characters=`Contrast: ${S.accessibility.onWhite.toFixed(2)}:1 (white)`,E.fills=[{type:"SOLID",color:{r:.42,g:.47,b:.57}}],y.appendChild(E);let $=figma.createFrame();$.resize(360,24),$.fills=[],$.layoutMode="HORIZONTAL",$.primaryAxisSizingMode="AUTO",$.counterAxisSizingMode="AUTO",$.itemSpacing=8;let O=figma.createFrame();O.resize(80,24),O.fills=[{type:"SOLID",color:S.accessibility.wcagAA?{r:.22,g:.8,b:.5}:{r:.95,g:.4,b:.4}}],O.cornerRadius=6,O.layoutMode="HORIZONTAL",O.primaryAxisSizingMode="AUTO",O.counterAxisSizingMode="AUTO",O.paddingLeft=8,O.paddingRight=8,O.paddingTop=4,O.paddingBottom=4;let N=figma.createText();N.fontName=d,N.fontSize=11,N.characters=S.accessibility.wcagAA?"\u2713 WCAG AA":"\u2717 WCAG AA",N.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],O.appendChild(N),$.appendChild(O);let D=figma.createFrame();D.resize(80,24),D.fills=[{type:"SOLID",color:S.accessibility.wcagAAA?{r:.22,g:.8,b:.5}:{r:.95,g:.4,b:.4}}],D.cornerRadius=6,D.layoutMode="HORIZONTAL",D.primaryAxisSizingMode="AUTO",D.counterAxisSizingMode="AUTO",D.paddingLeft=8,D.paddingRight=8,D.paddingTop=4,D.paddingBottom=4;let F=figma.createText();F.fontName=d,F.fontSize=11,F.characters=S.accessibility.wcagAAA?"\u2713 WCAG AAA":"\u2717 WCAG AAA",F.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],D.appendChild(F),$.appendChild(D),y.appendChild($),p.appendChild(y)}if(r.includeUseCases&&S.useCases&&S.useCases.length>0&&r.layout!=="compact"){let y=figma.createText();y.fontName=u,y.fontSize=12,y.characters="\u2192 "+S.useCases.slice(0,2).join(`
\u2192 `),y.fills=[{type:"SOLID",color:{r:.45,g:.5,b:.6}}],y.lineHeight={value:18,unit:"PIXELS"},p.appendChild(y)}x.appendChild(p),h.appendChild(x)}v.appendChild(h),m.appendChild(v)}m.x=figma.viewport.center.x-m.width/2,m.y=figma.viewport.center.y-m.height/2,figma.currentPage.selection=[m],figma.viewport.scrollAndZoomIntoView([m]),figma.notify(`\u2728 Documentation created in Figma! ${r.totalColors} colors documented.`),figma.ui.postMessage({type:"export-documentation-to-canvas-result",success:!0})}catch(r){console.error("Error creating documentation in canvas:",r);let i=(r==null?void 0:r.message)||(r==null?void 0:r.toString())||"Unknown error occurred";figma.notify(`Error: ${i}`),figma.ui.postMessage({type:"export-documentation-to-canvas-result",success:!1,error:i})}});return}if(e.type==="create-mesh-gradient"){G(null,null,function*(){let{points:r,width:i,height:l,influence:f=50,vignette:d=0,blendMode:u="normal",exportType:m="frame",noise:b=0,grainType:k="noise"}=e;try{let g=figma.createFrame();g.name="Mesh Gradient",g.resize(i,l),g.fills=[{type:"SOLID",color:{r:1,g:1,b:1},opacity:1}],g.clipsContent=!0,d>0&&(g.effects=[{type:"INNER_SHADOW",color:{r:0,g:0,b:0,a:d/100*.6},offset:{x:0,y:0},radius:Math.max(i,l)*.8,spread:0,visible:!0,blendMode:"NORMAL"}]);let v=Math.max(.1,Math.min(1,f/100));for(let I of r){let h=figma.createEllipse();h.name="Mesh Point";let S=Math.max(i,l)*(.2+v*.4);h.resize(S*2,S*2);let x=I.x/100*i,w=I.y/100*l;h.x=x-S,h.y=w-S;let{r:p,g:A,b:L}=U(I.color);h.fills=[{type:"SOLID",color:{r:p,g:A,b:L}}];let y=u.toUpperCase();["NORMAL","MULTIPLY","SCREEN","OVERLAY","DARKEN","LIGHTEN","COLOR_DODGE","COLOR_BURN","HARD_LIGHT","SOFT_LIGHT","DIFFERENCE","EXCLUSION","HUE","SATURATION","COLOR","LUMINOSITY"].includes(y)&&(h.blendMode=y),h.effects=[{type:"LAYER_BLUR",radius:S*(.5+v*.5),visible:!0}],g.appendChild(h)}if(b>0&&e.noiseTextureData){let I=new Uint8Array(e.noiseTextureData),h=figma.createImage(I),S=figma.createRectangle();S.name=`Grain Overlay (${k})`,S.resize(i,l),S.x=0,S.y=0,S.fills=[{type:"IMAGE",imageHash:h.hash,scaleMode:"TILE",scalingFactor:.5}];let x="OVERLAY";switch(k){case"fiber":x="SOFT_LIGHT";break;case"paper":x="MULTIPLY";break;case"film":x="OVERLAY";break;case"canvas":x="SOFT_LIGHT";break;default:x="OVERLAY"}S.blendMode=x,g.appendChild(S)}if(m==="image"){let I=yield g.exportAsync({format:"PNG",constraint:{type:"SCALE",value:2}}),h=figma.createImage(I).hash,S=figma.createRectangle();S.name="Mesh Gradient Image",S.resize(i,l),S.x=g.x,S.y=g.y,S.fills=[{type:"IMAGE",imageHash:h,scaleMode:"FILL"}],g.remove(),figma.viewport.scrollAndZoomIntoView([S]),figma.notify("Created Mesh Gradient as Image!")}else figma.viewport.scrollAndZoomIntoView([g]),figma.notify("Created Mesh Gradient!")}catch(g){console.error("Error creating mesh gradient:",g),figma.notify(`Error: ${g.message}`)}});return}if(e.type==="create-mesh-gradient-image"){G(null,null,function*(){let{imageData:r,width:i,height:l}=e;try{let f=new Uint8Array(r),d=figma.createImage(f),u=figma.createRectangle();u.name="Mesh Gradient Image",u.resize(i,l),u.fills=[{type:"IMAGE",imageHash:d.hash,scaleMode:"FILL"}],figma.viewport.scrollAndZoomIntoView([u]),figma.notify("Created Mesh Gradient as Image!")}catch(f){console.error("Error creating mesh gradient image:",f),figma.notify(`Error: ${f.message}`)}});return}if(e.type==="get-selection-colors"){G(null,null,function*(){let r=figma.currentPage.selection;if(r.length===0){figma.ui.postMessage({type:"selection-colors",colors:[]});return}let i=[],l=f=>{if("fills"in f&&Array.isArray(f.fills)){for(let d of f.fills)if(d.type==="SOLID"&&d.visible!==!1){let u=ce(d.color.r,d.color.g,d.color.b).toUpperCase();i.includes(u)||i.push(u)}}if("strokes"in f&&Array.isArray(f.strokes)){for(let d of f.strokes)if(d.type==="SOLID"&&d.visible!==!1){let u=ce(d.color.r,d.color.g,d.color.b).toUpperCase();i.includes(u)||i.push(u)}}if("children"in f)for(let d of f.children)l(d)};for(let f of r)if(l(f),i.length>=10)break;figma.ui.postMessage({type:"selection-colors",colors:i.slice(0,10)})});return}if(e.type==="create-color-variables-from-ai"){G(null,null,function*(){if(!figma.variables){figma.notify("Error: Variables API is not available in this file.");return}let{colors:r}=e;if(!r||!Array.isArray(r)||r.length===0){figma.notify("No colors to create variables from.");return}let i=["Primary","Secondary","Accent","Background","Surface","Text","Muted","Border","Highlight","Shadow"];try{let l=new Date().toLocaleString("en-GB",{month:"short",day:"numeric",hour:"numeric",minute:"numeric"}),f=figma.variables.createVariableCollection(`AI Colors (${l})`),d=f.modes[0].modeId,u=0;for(let m=0;m<r.length;m++){let b=r[m];if(typeof b=="string")try{let g=`AI Colors/${i[m]||`Color ${m+1}`}`,v=figma.variables.createVariable(g,f,"COLOR"),I=U(b);v.setValueForMode(d,qt(Wt({},I),{a:1})),u++}catch(k){console.error("Error creating variable:",k)}}figma.notify(`Success! Created ${u} color variables from AI palette.`)}catch(l){console.error("Error creating AI color variables:",l),figma.notify(`Error: ${l.message}`)}});return}if(e.type==="create-color-styles-from-ai"){G(null,null,function*(){let{colors:r}=e;if(!r||!Array.isArray(r)||r.length===0){figma.notify("No colors to create styles from.");return}let i=["Primary","Secondary","Accent","Background","Surface","Text","Muted","Border","Highlight","Shadow"];try{let l=0;for(let f=0;f<r.length;f++){let d=r[f];if(typeof d=="string")try{let m=`AI Colors/${i[f]||`Color ${f+1}`}`,b=figma.createPaintStyle();b.name=m;let k=U(d);b.paints=[{type:"SOLID",color:k}],l++}catch(u){console.error("Error creating style:",u)}}figma.notify(`Success! Created ${l} color styles from AI palette.`)}catch(l){console.error("Error creating AI color styles:",l),figma.notify(`Error: ${l.message}`)}});return}if(e.type==="close"&&figma.closePlugin(),e.type==="sample-figma-selection"){let r=figma.currentPage.selection;if(r.length===0){figma.notify("Please select something first");return}let i=[];if(r.forEach(l=>{if("fills"in l){let f=l.fills;Array.isArray(f)&&f.forEach(d=>{d.type==="SOLID"&&i.push(ce(d.color.r,d.color.g,d.color.b))})}}),i.length===0){figma.notify("No solid colors found in selection");return}figma.ui.postMessage({type:"selection-colors",colors:i})}});G(null,null,function*(){try{let e=yield figma.clientStorage.getAsync("procolors-brands");figma.ui.postMessage({type:"brands-loaded",brands:e||null})}catch(e){console.error("Error loading brands on start:",e),figma.ui.postMessage({type:"brands-loaded",brands:null,error:e.message})}try{let e=yield figma.clientStorage.getAsync("procolors-active-brand-id");figma.ui.postMessage({type:"active-brand-id-loaded",brandId:e||null})}catch(e){console.error("Error loading active brand ID on start:",e),figma.ui.postMessage({type:"active-brand-id-loaded",brandId:null,error:e.message})}})});ui();})();
